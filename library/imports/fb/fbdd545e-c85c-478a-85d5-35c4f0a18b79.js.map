{"version":3,"sources":["assets/scripts/GameProvider.js"],"names":["String","prototype","inArray","arr","console","log","i","k","length","Array","removeByValue","val","splice","minus","result","obj","j","push","common","require","socketProvider","cc","Class","properties","bcnt","hideDragItem","innerId","putSele","destroy","createBuff","buff","myBuff","px","py","canvasNode","node","parent","typeId","playSnd","instantiate","playerPrefab","dispCharSele","clickSele","mypos","x","y","moveTo","v2","setPosition","addChild","createAgents","agents","aid","myAgent","agent","agentNode","eo","npcInfo","objectForKey","role","name","type","active","size","level","getComponentByRole","init","setId","setShadow","shadowForAgent","setTotalLife","life","setBlood","bloodForAgent","mainPlayer","rot","updatePos","setObject","createBullets","bullets","myBullet","bullet","eDis","startPos","enemeyDistance","targetpos","targetDis","updown","zIndex","bulletRot","angle","createBases","bases","baseName","baseNode","objectId","baseObj","getChildByName","getComponent","setLife","createLogs","logs","shadowForLog","move","createForts","forts","zorder","spName","parseInt","setZIndex","agentProcess","remoteAgents","localAgents","killAgents","agentObj","agentId","allKeys","remove","removedNpcInfo","removeObjectForKey","baseProcess","remoteBases","killBases","enemyBases","warriorName","warriorObj","_defaultBases","dispLayoutMask","removeChild","playEffect","plusBaseKillNum","enemynum","mynum","string","dir","bd","undisplayMask","sel","killEnemyBases","_self","showMask","showDragMask","ifNotMaskRole","maskType","unshowDragMask","delay","scheduleOnce","putErrorMsg","undisplayPutErr","fortProcess","fortsFuture","logProcess","bulletProcess","remoteBullets","localBullets","killBullets","startSceneJitter","sceneNode","ox","oy","cnt","lower","upper","callBack","randomX","Math","floor","random","randomY","stopAllActions","del","delayTime","cal","callFunc","seq","sequence","runAction","repeatForever","playBases","kingNode","kingArrow","warrior","actType","attackDura","now","tmpB","eoDead","playBaseWarriorAnimationDefault","playBaseWarriorAnimation","playAgents","agentsFuture","playAni","getFutureAgent","setGroupKill","groupKill","round","playForts","playFortWarriorAnimationDefault","isHero","playLogs","sc","playBullets","subBullet","showBullet","pp","convertToWorldSpaceAR","convertToNodeSpaceAR","getFireBombScale","scaleX","scaleY","lastpos","sub","mag","bulletPos","targetPos","xDif","yDif","midPos","dis","sqrt","ex","ey","getKilledEnemies","aids","killedEnemies","bloodObj","bloodOp","setBarLevel","shadowObj","sacleY","setClickItem","select","putClickItem","selCard","pt","putNode","nick","Number","Date","setDragItem","params","card","target","dragNode","actvie","draggingItem","unsetDragItem","moveDragItem","delta","clearDragItem","param","_name","layoutPt","position","yOffset","magicCost","isValidPutPoint","sendSodier","bar","juice","cost","useMagic","width","MY_SOCKET","json","emit","roomId","setMagicBar","addJuice","magicAmount","updateCardStatus","amount","afterUse","head","nodeName","selNode","selSprite","color","Color"],"mappings":"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","sourceRoot":"/","sourcesContent":["// 定义一个判断函数\nString.prototype.inArray = function(arr) {\n    // 不是数组则抛出异常\n    if(!arr){\n       console.log(\"ERR(in_array):Input is not an array\");\n    }\n    // 遍历是否在数组中\n    for(var i=0,k=arr.length;i<k;i++) {\n        if(this==arr[i]) {\n            return true;\n        }\n    }\n    // 如果不在数组中就会返回false\n    return false;\n};\n\nArray.prototype.removeByValue = function(val) {\n    for(var i=0;i<this.length;i++) {\n        if(this[i] == val) {\n            this.splice(i, 1);\n            break;\n        }\n    }\n};\n\nArray.prototype.minus = function (arr) {\n    var result = new Array();\n    var obj = {};\n    for (var i = 0; i < arr.length; i++) {\n        obj[arr[i]] = 1;\n    }\n    for (var j = 0; j < this.length; j++) {\n        if (!obj[this[j]])\n        {\n            obj[this[j]] = 1;\n            result.push(this[j]);\n        }\n    }\n    return result;\n};\n\nvar common = require(\"Common\");\nvar socketProvider = require(\"SocketProvider\");\n\ncc.Class({\n    extends: socketProvider,\n\n    properties: {\n        bcnt:0\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    // start () {},\n\n    hideDragItem:function (innerId) {\n        if(this.putSele[innerId]) {\n            this.putSele[innerId].destroy();\n            this.putSele[innerId] = null;\n        }\n    },\n\n    createBuff:function(buff) {\n        var myBuff,px,py;\n        var canvasNode = this.node.parent;\n\n        if(buff.typeId == 1) {\n            this.playSnd(\"thunder\");\n            myBuff = cc.instantiate(this.playerPrefab[23]);\n            //canvasNode.getChildByName(\"buffThunder\").active = false;\n        }\n        else if(buff.typeId == 2) {\n            this.playSnd(\"heal\");\n            myBuff = cc.instantiate(this.playerPrefab[24]);\n            //canvasNode.getChildByName(\"buffHeal\").active = false;\n        }\n        \n        //hide select frame\n        this.dispCharSele();\n\n        //remove buff icon\n        if(this.putSele[buff.innerId]) {\n            this.putSele[buff.innerId].parent.destroy();\n        }\n\n        //hide drag item disp\n        //this.hideDragItem(buff.innerId);\n\n        this.clickSele = {};\n\n        //todo 38\n        px = (buff.mypos.x)*38;\n        py = (buff.mypos.y)*38;\n\n        var moveTo = cc.v2(px, py);\n        myBuff.setPosition(moveTo);\n\n        this.node.addChild(myBuff);\n    },\n\n    createAgents:function(agents) {\n        var aid,myAgent,agent,agentNode;\n        var px,py,eo;\n        //var nodelist = cc.find(\"Canvas/layout\");\n        //console.log(nodelist);\n\n        for(var i=0;i<agents.length;i++) {\n            agent = agents[i];\n\n            aid = agent.aid;\n            myAgent = this.npcInfo.objectForKey(aid);\n\n            //px = (agent.mypos.x)*38;\n            //py = (agent.mypos.y)*38;\n\n            if(myAgent == null) {\n                this.hideDragItem(agent.innerId);\n\n                if(agent.role == \"ske\") {\n                    myAgent = cc.instantiate(this.playerPrefab[0]);    \n                }\n                else if(agent.role == \"ir\") {\n                    myAgent = cc.instantiate(this.playerPrefab[20]); \n                }\n                else if(agent.role == \"bee\") {\n                    myAgent = cc.instantiate(this.playerPrefab[16]);    \n                }\n                else if(agent.role == \"wiz\") {\n//myAgent = cc.instantiate(this.playerPrefab[17]);    \n                    myAgent = cc.instantiate(this.playerPrefab[26]);\n                }\n                else if(agent.role == \"hr\") {\n                    myAgent = cc.instantiate(this.playerPrefab[12]);    \n                }\n                else if(agent.role == \"lm\") {\n                    myAgent = cc.instantiate(this.playerPrefab[14]);    \n                }\n                else if(agent.role == \"lr\") {\n                    myAgent = cc.instantiate(this.playerPrefab[3]);    \n                }\n                else if(agent.role == \"gi\") {\n                    myAgent = cc.instantiate(this.playerPrefab[4]);    \n                } else {\n                    continue;\n                }\n\n                myAgent.name = aid;\n                myAgent.type = \"agent\";\n                myAgent.active = true;\n                myAgent.role = agent.role;\n                myAgent.size = agent.size;\n                myAgent.level = agent.level;\n\n                agentNode = this.getComponentByRole(myAgent);\n                agentNode.init();\n                agentNode.setId(aid);\n\n                //shadow should set in layout, because its zindex should be lower than any agents.\n                agentNode.setShadow(this.shadowForAgent());\n\n                agentNode.setTotalLife(agent.life);\n                agentNode.setBlood(this.bloodForAgent(myAgent));\n\n                //if init pos is in south, face to north, otherwise....\n                if(this.mainPlayer == 1) {\n                    agent.rot = 180;\n                }\n                else if(this.mainPlayer == 2) {\n                    agent.rot = 0;        \n                }\n\nconsole.log(\"--rec pt--\");\nconsole.log(agent.mypos.x +\":::\"+ agent.mypos.y);\n\n                px = (agent.mypos.x)*38;\n                py = (agent.mypos.y)*38;\n\n                agentNode.updatePos(px, py);\n\n                this.node.addChild(myAgent);\n                this.npcInfo.setObject(myAgent, aid);\n            }\n        }\n    },\n\n    createBullets:function(bullets) {\n        var aid,myBullet,bullet,agentNode;\n        var px,py,eo,eDis;\n\n        for(var i=0;i<bullets.length;i++) {\n            bullet = bullets[i];\n            aid = bullet.aid;\n            myBullet = this.npcInfo.objectForKey(aid);\n\n            if(myBullet == null) {\n                if(bullet.role==\"bullet\") {\n                    myBullet = cc.instantiate(this.playerPrefab[1]);\n                    \n                    //myBullet = new cc.Node();\n                    myBullet.startPos = bullet.mypos;\n                    myBullet.active = false;\n                }\n                else if(bullet.role==\"bomb\") {\n                    console.log(\"bomb created\");\n                    this.playSnd(\"fireSend\");\n                    this.hideDragItem(bullet.innerId);\n                    myBullet = cc.instantiate(this.playerPrefab[5]);    \n                    eDis = this.enemeyDistance(bullet.mypos.x, bullet.mypos.y, bullet.targetpos.x, bullet.targetpos.y);\n                    myBullet.startPos = bullet.mypos;\n                    myBullet.targetDis = eDis;\n                }\n                else if(bullet.role==\"tama\") {\n                    this.playSnd(\"gun\");\n                    myBullet = cc.instantiate(this.playerPrefab[9]);\n                    myBullet.startPos = bullet.mypos;\n                    myBullet.active = false;\n                }\n                else if(bullet.role==\"wizfire\") {\n                    myBullet = cc.instantiate(this.playerPrefab[18]);\n                    myBullet.startPos = bullet.mypos;\n                    myBullet.active = false;\n                }\n                else {\n                    console.log(\"error, no bullet type.\");\n                }\n\n                myBullet.name = aid;\n                myBullet.type = \"bullet\";\n                //myBullet.active = true;\n                myBullet.role = bullet.role;\n                myBullet.updown = bullet.updown;\n\n                myBullet.zIndex = 9999;\n\n                agentNode = this.getComponentByRole(myBullet);\n\n                // 将新增的节点添加到 Canvas 节点下面\n                this.node.addChild(myBullet);\n\n                //px = -1000;\n                //py = -1000;\n                \n                px = 50;\n                py = 50;\n\n\n                var moveTo = cc.v2(px, py);\n\n                var bulletRot = bullet.rot;\n                if(this.mainPlayer == 1) {\n                    bulletRot += 180;\n                }\n\n                //since 2.1.1 setRotation is desperated.\n                myBullet.angle = -1*bulletRot;\n                //myBullet.setRotation(bulletRot);  //bullet.rot+180\n\n                myBullet.setPosition(moveTo);\n\n                this.npcInfo.setObject(myBullet, aid);\n            }\n        }\n    },\n\n    createBases:function(bases) {\n        var aid,myAgent,agent,baseName,baseNode;\n\n        for(var i=0;i<bases.length;i++) {\n            agent = bases[i];\n            aid = agent.aid;\n            myAgent = this.npcInfo.objectForKey(aid);\n\n            if(myAgent == null) {\n                myAgent = {};\n                myAgent.name = aid;\n                myAgent.type = \"base\";\n                myAgent.active = true;\n                myAgent.role = agent.role;\n                myAgent.mypos = agent.mypos;\n                myAgent.size = agent.size;\n\n                baseName = \"base\"+ agent.objectId;\n                myAgent.baseObj = this.node.getChildByName(baseName);\n\n                baseNode = myAgent.baseObj.getComponent(\"BaseSprite\");\n                baseNode.setTotalLife(agent.life);\n                baseNode.setBlood(this.bloodForAgent(myAgent.baseObj));\n                baseNode.setLife(agent.life);\n\n                this.npcInfo.setObject(myAgent, aid);\n            }\n        }\n    },\n\n    createLogs:function(logs) {\n        var aid,myAgent,agent,agentNode;\n        var px,py;\n\n        //this.playSnd(\"log\");\n\n        for(var i=0;i<logs.length;i++) {\n            agent = logs[i];\n            aid = agent.aid;\n\n            myAgent = this.npcInfo.objectForKey(aid);\n\n            //todo 38\n            px = (agent.mypos.x)*38;\n            py = (agent.mypos.y)*38;\n\n            if(myAgent == null) {\n                this.hideDragItem(agent.innerId);\n\n                myAgent = cc.instantiate(this.playerPrefab[8]);\n                myAgent.name = aid;\n                myAgent.type = \"log\";\n                myAgent.active = true;\n                myAgent.role = agent.role;\n\n                agentNode = this.getComponentByRole(myAgent);\n                agentNode.setId(aid);\n                agentNode.setShadow(this.shadowForLog());\n\n                var moveTo = cc.v2(px, py);\n                agentNode.move(moveTo);\n\n                // 将新增的节点添加到 Canvas 节点下面\n                this.node.addChild(myAgent);\n                this.playSnd(\"log\");\n\n                this.npcInfo.setObject(myAgent, aid);\n            }\n        }\n    },\n\n    createForts:function(forts) {\n        var aid,myAgent,agent,agentNode;\n        var px,py,eo,zorder;\n\n        //var nodelist = cc.find(\"Canvas/layout\");\n        //console.log(nodelist);\n\n        for(var i=0;i<forts.length;i++) {\n            agent = forts[i];\n            aid = agent.aid;\n            myAgent = this.npcInfo.objectForKey(aid);\n\n            //todo 38\n            px = (agent.mypos.x)*38;\n            py = (agent.mypos.y)*38;\n\n            if(myAgent == null) {\n                this.hideDragItem(agent.innerId);\n\n                myAgent = cc.instantiate(this.playerPrefab[7]);    \n                myAgent.name = aid;\n                myAgent.type = \"fa\";\n                myAgent.spName = \"FortASprite\";\n                myAgent.active = true;\n                myAgent.role = agent.role;\n                myAgent.size = agent.size;\n\n                //1000:agent, 999:bullet 998:this;\n                //fort base anchorY is middle, so y-2 is nessesary.\n\n                //todo 16\n                if(this.mainPlayer == 1) {\n                    zorder = 1001+parseInt(16-agent.mypos.y-1);\n                } \n                else if(this.mainPlayer == 2) {\n                    zorder = 1001+parseInt(16-agent.mypos.y-1);\n                }\n                myAgent.zIndex = zorder;\n\n                agentNode = this.getComponentByRole(myAgent);\n                agentNode.setZIndex(zorder);\n/*                \n                //agentNode.init();\n                //agentNode.setId(aid);\n                //agentNode.setShadow(this.shadowForAgent());\n*/\n\n                agentNode.setTotalLife(agent.life);\n                agentNode.setBlood(this.bloodForAgent(myAgent));\n\n                //if init pos is in south, face to north, otherwise....\n                if(this.mainPlayer == 1) {\n                    agent.rot = 180;\n                }\n                else if(this.mainPlayer == 2) {\n                    agent.rot = 0;        \n                }\n\n                var moveTo = cc.v2(px, py);\n                myAgent.setPosition(moveTo);\n\n                //agentNode.playAngleAnimation(agent, null, this.mainPlayer);\n\n                // 将新增的节点添加到 Canvas 节点下面\n                this.node.addChild(myAgent);\n\n                this.npcInfo.setObject(myAgent, aid);\n            }\n        }\n    },\n\n    agentProcess: function(agents) {\n        var remoteAgents = [];\n        var localAgents = [];\n        var killAgents = [];\n        var agentObj, agentNode;\n        var agentId;\n\n        for(var i=0;i<agents.length;i++) {\n            remoteAgents.push(agents[i].aid);\n        }\n\n        localAgents = this.npcInfo.allKeys();\n        killAgents = localAgents.minus(remoteAgents);\n\n        for(agentId of killAgents) {\n            agentObj = this.npcInfo.objectForKey(agentId);\n            if(agentObj.type == \"agent\") {\n                agentNode = this.getComponentByRole(agentObj);\n                agentNode.remove();\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n            }\n        }\n    },\n\n    baseProcess: function(bases) {\n        var remoteBases = [];\n        var killBases = [];\n        var enemyBases = [];\n        var baseObj;\n        var warriorName;\n        var warriorObj;\n        var baseName;\n\n        for(var i=0;i<bases.length;i++) {\n            baseName = \"base\"+ bases[i].objectId;\n            remoteBases.push(baseName);\n            enemyBases.push(baseName);\n        }\n\n        // todo list: should manage to remove the base record in npcInfo.\n        killBases = this._defaultBases.minus(remoteBases);\n\n        for(baseName of killBases) {\n            this.dispLayoutMask(enemyBases, baseName);\n\n            this._defaultBases.removeByValue(baseName);\n            baseObj = this.node.getChildByName(baseName);\n\n            //this.plusBaseKillNum(baseName);\n            \n            this.node.removeChild(baseObj);\n            this.playEffect(\"base\", baseObj.x, baseObj.y);\n        }\n    },\n \n    plusBaseKillNum: function(baseName) {\n        //todo: layout node must be set in init \n        var enemynum = this.node.getChildByName(\"upFlag\").getChildByName(\"ringMark\").getChildByName(\"killnum\").getComponent(\"cc.Label\");\n        var mynum = this.node.getChildByName(\"downFlag\").getChildByName(\"ringMark\").getChildByName(\"killnum\").getComponent(\"cc.Label\");\n        \n        if(baseName.inArray([\"base1\", \"base2\", \"base3\"])) {\n            enemynum.string = parseInt(enemynum.string)+1;\n        } else {\n            mynum.string = parseInt(enemynum.string)+1;            \n        }\n    },\n\n    //called when game is over\n    killBases:function(dir) {\n        //todo: layout node must be set in init \n        //var enemynum = this.node.getChildByName(\"upFlag\").getChildByName(\"ringMark\").getChildByName(\"killnum\").getComponent(\"cc.Label\");\n        //var mynum = this.node.getChildByName(\"downFlag\").getChildByName(\"ringMark\").getChildByName(\"killnum\").getComponent(\"cc.Label\");\n      \n        var killBases;\n        var baseObj, bd;\n        var baseName;\n        if(dir == \"up\") {\n            killBases= [\"base1\", \"base2\", \"base3\"];\n            //enemynum.string = 3;\n        } else {\n            killBases= [\"base4\", \"base5\", \"base6\"];\n            //mynum.string = 3;\n        }\n\n        for(baseName of killBases) {\n            //this._defaultBases.removeByValue(baseName);\n            baseObj = this.node.getChildByName(baseName);\n\n            if(baseObj) {\n                this.playEffect(\"base\", baseObj.x, baseObj.y);\n                this.node.removeChild(baseObj);\n            }\n        }\n    },\n\n    undisplayMask: function(sel) {\n        console.log(sel);\n        this.node.getChildByName(sel).active=false;\n    },\n\n    dispLayoutMask: function(killEnemyBases, baseName) {\n        var _self = this;\n        if(baseName == \"base4\" || baseName == \"base5\" || baseName == \"base6\") {\n            return;\n        }\n\n        //if(\"base1\".inArray(killEnemyBases) && \"base2\".inArray(killEnemyBases) && \"base3\".inArray(killEnemyBases)) {\n        //    return;\n        //}\n\n        if(\"base1\".inArray(killEnemyBases) && \"base2\".inArray(killEnemyBases)) {\n            this.showMask(\"seleMask12\", 2);\n        }\n        else if(\"base1\".inArray(killEnemyBases) && \"base3\".inArray(killEnemyBases)) {\n            this.showMask(\"seleMask13\", 2);\n        }\n        else if(\"base1\".inArray(killEnemyBases)) {\n            this.showMask(\"seleMask1\", 2);\n        }\n    },\n\n    showDragMask: function(role) {\n        if(!this.ifNotMaskRole(role)) {\n            this.node.getChildByName(this.maskType).active=true;\n        }\n    },\n\n    unshowDragMask: function() {\n        this.node.getChildByName(this.maskType).active=false;\n    },\n\n    showMask: function(maskType, delay) {\n        var _self = this;\n        this.maskType = maskType;\n        this.node.getChildByName(maskType).active=true;\n        this.scheduleOnce(function() {\n            _self.undisplayMask(maskType);\n        }, delay);\n    },\n\n    putErrorMsg: function() {\n        var _self = this;\n        this.node.getChildByName(\"putError\").active=true;\n        this.scheduleOnce(function() {\n            _self.undisplayPutErr();\n        }, 1);\n    },\n\n    undisplayPutErr: function() {\n        this.node.getChildByName(\"putError\").active=false;\n    },\n\n    fortProcess: function(forts, fortsFuture) {\n        var remoteAgents = [];\n        var localAgents = [];\n        var killAgents = [];\n        var agentObj, agentNode;\n        var agentId, bd;\n\n        for(var i=0;i<forts.length;i++) {\n            remoteAgents.push(forts[i].aid);\n        }\n\n        localAgents = this.npcInfo.allKeys();\n        killAgents = localAgents.minus(remoteAgents);\n\n        for(agentId of killAgents) {\n            agentObj = this.npcInfo.objectForKey(agentId);\n            if(agentObj.type == \"fa\") {\n                this.playEffect(\"fort\", agentObj.x, agentObj.y);\n\n                //agentNode = this.getComponentByRole(agentObj);\n                //agentNode.remove();\n                this.node.removeChild(agentObj);\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n\n                this.playEffect(\"base\", agentObj.x, agentObj.y);\n            }\n        }\n    },\n\n    logProcess: function(logs) {\n        var remoteAgents = [];\n        var localAgents = [];\n        var killAgents = [];\n        var agentObj, agentNode;\n        var agentId, bd;\n\n        for(var i=0;i<logs.length;i++) {\n            remoteAgents.push(logs[i].aid);\n        }\n\n        localAgents = this.npcInfo.allKeys();\n        killAgents = localAgents.minus(remoteAgents);\n\n        for(agentId of killAgents) {\n            agentObj = this.npcInfo.objectForKey(agentId);\n            if(agentObj.role == \"log\") {\n                this.playEffect(\"log\", agentObj.x, agentObj.y);\n\n                agentNode = this.getComponentByRole(agentObj);\n                agentNode.remove();\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n            }\n        }\n    },\n\n    bulletProcess: function(bullets) {\n        var remoteBullets = [];\n        var localBullets = [];\n        var killBullets = [];\n        var agentObj, agentNode;\n        var agentId;\n\n        for(var i=0;i<bullets.length;i++) {\n            remoteBullets.push(bullets[i].aid);\n        }\n\n        localBullets = this.npcInfo.allKeys();\n        killBullets = localBullets.minus(remoteBullets);\n\n        for(agentId of killBullets) {\n            agentObj = this.npcInfo.objectForKey(agentId);\n            if(agentObj.role == \"bomb\") {\n                agentNode = this.getComponentByRole(agentObj);\n                agentObj.destroy();\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n                this.playEffect(\"bomb\", agentObj.x, agentObj.y);\n            }\n            if(agentObj.role == \"wizfire\") {\n                agentNode = this.getComponentByRole(agentObj);\n                agentObj.destroy();\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n                if(agentObj.x && agentObj.y) {\n                    this.playEffect(\"wizfire\", agentObj.x, agentObj.y);\n                }\n            }\n            else if(agentObj.role == \"bullet\" || agentObj.role == \"tama\") {\n                agentNode = this.getComponentByRole(agentObj);\n                agentObj.destroy();\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n            }\n        }\n    },\n\n    //shake the screen\n    startSceneJitter: function(){\n        var sceneNode = this.node;\n        var ox = sceneNode.x;\n        var oy = sceneNode.y;\n\n        var cnt = 0;\n\n        var lower = -4;\n        var upper = 4;\n        var callBack = function(){\n            cnt++;\n            var randomX = Math.floor(Math.random() * (upper - lower)) + lower;\n            var randomY = Math.floor(Math.random() * (upper - lower)) + lower;\n            \n            sceneNode.x += randomX;\n            sceneNode.y += randomY;\n            if(cnt>=10) {\n                sceneNode.stopAllActions();\n                sceneNode.x = ox;\n                sceneNode.y = oy;\n            }\n        }\n\n        var node = this.node;//场景常驻节点\n        var del = cc.delayTime(1/30);\n        var cal = cc.callFunc(callBack);\n        var seq = cc.sequence(del, cal);\n        node.runAction(cc.repeatForever(seq));\n    },\n\n    playBases: function(bases) {\n        var remoteBases = [];\n        var baseObj,myAgent,agent;\n        var warriorName;\n        var warriorObj;\n        var baseName, kingNode, agentNode, kingArrow,warrior;\n        var actType, attackDura, now;\n        var tmpB = {};\n        var eoDead;\n        var eo = null;\n\n        for(var i=0;i<bases.length;i++) {\n            agent = bases[i];\n\n            baseName = \"base\"+ agent.objectId;\n            attackDura = agent.attackDura;\n            myAgent = this.npcInfo.objectForKey(agent.aid).baseObj;\n\n            tmpB[agent.aid] = baseName;\n            remoteBases.push(baseName);\n            actType = agent.actType;\n\n            if(myAgent) {\n                myAgent.getComponent(\"BaseSprite\").setLife(agent.life);\n\n                warrior = myAgent.getChildByName(\"warrior\");\n                if(warrior) {\n                    warrior.role = \"lr\";\n                    agentNode = this.getComponentByRole(warrior);\n\n                    //if no enmey then standby\n                    if(myAgent && agent.actType==\"wait\") {\n                        agentNode.playBaseWarriorAnimationDefault(\"move\", agent.objectId);\n                    }\n                    else if(myAgent && agent.actType==\"sa\") {\n                        agentNode.playBaseWarriorAnimation(agent, this.mainPlayer, \"sa\");\n                    }                     \n                }\n                warrior = myAgent.getChildByName(\"gun\");\n                if(warrior) {\n                    warrior.role = \"gun\";\n                    agentNode = this.getComponentByRole(warrior);\n\n                    //if no enmey then standby\n                    if(myAgent && agent.actType==\"wait\") {\n                        //agentNode.playFortWarriorAnimationDefault(\"move\", this.mainPlayer, agent.objectId);\n                    }\n                    else if(myAgent && agent.actType==\"sa\") {\n                        agentNode.playBaseWarriorAnimation(agent, this.mainPlayer, \"sa\");\n                    }\n                }\n            }\n        }\n    },\n\n    playAgents: function(agents, agentsFuture) {\n        var myAgent;\n        var px, py, aid;\n        var agentNode,agent,eo=null;\n        var eoDead;\n\n        for(var i=0;i<agents.length;i++) {\n            agent = agents[i];\n            myAgent = this.npcInfo.objectForKey(agent.aid);\n\n            if(myAgent && myAgent.type==\"agent\") {\n                agentNode = this.getComponentByRole(myAgent);\n                agentNode.playAni(agent, this.getFutureAgent(agent.aid, agentsFuture), this.mainPlayer);\n                agentNode.setLife(agent.life);\n                agentNode.setGroupKill(agent.groupKill);\n\n                px = Math.round((agent.mypos.x)*38);\n                py = Math.round((agent.mypos.y)*38);\n                agentNode.updatePos(px, py);\n            }\n        }\n    },\n\n    playForts: function(forts) {\n        var myAgent;\n        var agentNode,agent,warrior=null;\n\n        for(var i=0;i<forts.length;i++) {\n            agent = forts[i];\n            myAgent = this.npcInfo.objectForKey(agent.aid);\n            if(!myAgent) {\n                continue;\n            }\n            myAgent.role = \"fa\";\n            agentNode = this.getComponentByRole(myAgent);\n            agentNode.setLife(agent.life);\n\n            warrior = myAgent.getChildByName(\"warrior\");\n            warrior.role = \"lr\";\n            agentNode = this.getComponentByRole(warrior);\n\n            //if no enmey then standby\n            if(myAgent && agent.actType==\"move\") {\n                agentNode.playFortWarriorAnimationDefault(\"move\", agent.isHero, this.mainPlayer);\n            }\n            else if(myAgent && agent.actType==\"sa\") {\n                agentNode.playBaseWarriorAnimation(agent, this.mainPlayer, \"sa\");\n            } \n        }\n    },\n\n    playLogs: function(logs) {\n        var agent,myAgent;\n        var px, py, aid;\n        var agentNode,bullet,eo=null;\n        var sc;\n        var moveTo;\n\n        for(var i=0;i<logs.length;i++) {\n            agent = logs[i];\n            myAgent = this.npcInfo.objectForKey(agent.aid);\n\n            if(myAgent) {\n                agentNode = this.getComponentByRole(myAgent);\n                agentNode.move(agent.mypos);\n            }\n        }\n    },\n\n    playBullets: function(bullets) {\n        var myBullet;\n        var px, py, aid;\n        var agentNode,bullet,eo=null;\n        var sc;\n        var bulletRot;\n        var subBullet;\n\n        for(var i=0;i<bullets.length;i++) {\n            bullet = bullets[i];\n\n            myBullet = this.npcInfo.objectForKey(bullet.aid);\n            if(myBullet) {\n                //2 fort bullet emit the same time, only display the proper bullet.\n                if(bullet.updown==\"up\" && this.mainPlayer==2) {\n                    continue;\n                }\n                if(bullet.updown==\"down\" && this.mainPlayer==1) {\n                    continue;\n                }\n\n                this.showBullet(myBullet, bullet);\n            }\n        }\n    },\n\n    showBullet: function(myBullet, bullet) {\n        var subBullet, agentNode, px, py, moveTo, bulletRot;\n\n        myBullet.active = true;\n\n        agentNode = this.getComponentByRole(myBullet);\n\n        //todo 38\n        px = (bullet.mypos.x)*38;\n        py = (bullet.mypos.y)*38;\n\n        moveTo = cc.v2(px, py);\n\n        bulletRot = bullet.rot;\n        //if(this.mainPlayer == 1) {\n        //    bulletRot += 180;\n        //}\n\n        //1000:agent, 999:this bullet 998:forts;\n        //make bullet display under agent which is at same position.\n        //todo 16\n        myBullet.zIndex = 1000+parseInt(16-bullet.mypos.y);\n\n        if(myBullet.role == \"bullet\") {\n            subBullet = cc.instantiate(this.playerPrefab[1]);\n            //subBullet = cc.instantiate(this.playerPrefab[25]);\n\n            // first convert moveTo(belong to layout node) to world position.\n            var pp = this.node.convertToWorldSpaceAR(moveTo);\n\n            // convert world postion to myBullet position.\n            pp = myBullet.convertToNodeSpaceAR(pp);\n\n            if(this.mainPlayer == 1) {\n                myBullet.angle = 90 - bulletRot;\n            } else {\n                myBullet.angle = (90 - bulletRot)*-1;            \n            }\n\n            subBullet.setPosition(pp);\n            myBullet.addChild(subBullet);\n        } \n\n        else if(myBullet.role == \"bomb\") {\n            sc = this.getFireBombScale(bullet.mypos, bullet.targetpos, myBullet.targetDis, myBullet.startPos);\n            myBullet.scaleX=sc;\n            myBullet.scaleY=sc;\n            myBullet.zIndex = 9999;\n\n            myBullet.angle = -1*bulletRot;\n            myBullet.setPosition(moveTo);\n\n            /*\n                var randomTime = Math.ceil(Math.random()*40)-10;\n                var fh = myBullet.getChildByName(\"fireHead\");\n                //fh.skewY = randomTime;\n                //fh.skewX = randomTime;\n\n                //fire bomb size changing according to the distance between target and origin.\n                sc = this.getFireBombScale(bullet.mypos, bullet.targetpos, myBullet.targetDis, myBullet.startPos);\n                agentNode.node.scaleX=sc;\n                agentNode.node.scaleY=sc;\n                myBullet.getComponent(cc.MotionStreak).stroke *= sc;\n            */\n        }\n\n        else if(myBullet.role == \"wizfire\") {\n            /* \n            //old wiz fire ball\n\n            myBullet.zIndex = 9999;\n            // shake a little bit\n            //var randomTime = Math.ceil(Math.random()*40)-10;\n            //bulletRot += randomTime;\n\n            myBullet.angle = -1*bulletRot;                \n            myBullet.setPosition(moveTo);\n            */\n\n            subBullet = cc.instantiate(this.playerPrefab[25]);\n\n            // first convert moveTo(belong to layout node) to world position.\n            var pp = this.node.convertToWorldSpaceAR(moveTo);\n\n            // convert world postion to myBullet position.\n            pp = myBullet.convertToNodeSpaceAR(pp);\n\n            //subBullet.setPosition(pp);\n            //myBullet.addChild(subBullet);\n\n            if(myBullet.lastpos && myBullet.lastpos.sub(pp).mag() > 50) {\n                subBullet.setPosition(pp);\n                myBullet.addChild(subBullet);\n                myBullet.lastpos = pp;\n            }\n\n            if(!myBullet.lastpos) {\n                subBullet.setPosition(pp);\n                myBullet.addChild(subBullet);\n                myBullet.lastpos = pp;                    \n            }\n\n        }\n\n        else {\n            myBullet.angle = -1*bulletRot;                \n            myBullet.setPosition(moveTo);\n        }\n    },\n\n    getFireBombScale: function(bulletPos, targetPos, targetDis, startPos) {\n        var xDif, yDif;\n        var midPos = {};\n        midPos.x = startPos.x + (targetPos.x - startPos.x)/2;\n        midPos.y = startPos.y + (targetPos.y - startPos.y)/2;\n        var xDif = bulletPos.x - midPos.x;\n        var yDif = bulletPos.y - midPos.y;\n        var dis = Math.sqrt((xDif * xDif) + (yDif * yDif));\n        var targetDis = targetDis * 0.5;\n\n        return (targetDis-dis)*0.7/targetDis+0.5;   //scale from 0.5 -- 1.2\n    },\n\n    enemeyDistance:function(px,py,ex,ey) {\n        var xDif, yDif, dis;\n        xDif = px - ex;\n        yDif = py - ey;\n        dis = Math.sqrt((xDif * xDif) + (yDif * yDif));\n        return dis;\n    },\n\n    getComponentByRole(agentObj) {\n        var role = agentObj.role;\n        if(role == \"ske\") {\n            return agentObj.getComponent('SkeSprite');\n        }\n        else if(role == \"ir\") {\n            return agentObj.getComponent('SkeSprite');\n        }\n        else if(role == \"bee\") {\n            return agentObj.getComponent('BeeSprite');\n        }\n        else if(role == \"wiz\") {\n//return agentObj.getComponent('WizSprite');\n            return agentObj.getComponent('NFTArcherSprite');\n        }\n        else if(role == \"hr\") {\n            return agentObj.getComponent('HeroSprite');\n        }\n        else if(role == \"lm\") {\n            return agentObj.getComponent('LightmanSprite');\n        }\n        else if(role == \"lr\") {\n            return agentObj.getComponent('ArcSprite');\n        }\n        else if(role == \"gi\") {\n            return agentObj.getComponent('GiantSprite');\n        }\n        else if(role == \"bullet\") {\n            return agentObj.getComponent('Arrow');\n        }\n        else if(role == \"bomb\") {\n            return agentObj.getComponent('BombScript');\n        }\n        else if(role == \"log\") {\n            return agentObj.getComponent('LogSprite');\n        }\n        else if(role == \"gun\") {\n            return agentObj.getComponent('GunSprite');\n        }\n        else if(role == \"base\") {\n            return agentObj.getComponent('BaseSprite');\n        }\n        else if(role == \"fa\") {\n            return agentObj.getComponent('BaseSprite');\n        }\n    },\n\n    getKilledEnemies: function() {\n        var aids = this.removedNpcInfo.allKeys();\n        var aid;\n        var killedEnemies = [];\n        //when one attack cause multi kills occured in one frame, multi enemies must be handled. \n        for(var i=0;i<aids.length;i++) {\n            aid = aids[i];\n            killedEnemies.push(this.removedNpcInfo.objectForKey(aid));\n        }\n\n        return killedEnemies;\n    },\n\n    getFutureAgent: function(aid, agentsFuture) {\n        for(var i=0;i<agentsFuture.length;i++) {\n            if(agentsFuture[i].aid == aid) {\n                return agentsFuture[i];\n            }\n        }\n        return null;\n    },\n\n    bloodForAgent: function (agent) {\n        var bloodObj = cc.instantiate(this.playerPrefab[11]);\n        var bloodOp = bloodObj.getComponent(\"BloodBar\");\n        bloodOp.setBarLevel(agent.level);\n\n        bloodObj.active = false;\n        agent.addChild(bloodObj);\n        return bloodObj;\n    },\n\n    shadowForAgent: function () {\n        var shadowObj = cc.instantiate(this.playerPrefab[2]);\n        shadowObj.active = false;\n        this.node.addChild(shadowObj);\n        return shadowObj;\n    },\n\n    shadowForLog: function () {\n        var shadowObj = cc.instantiate(this.playerPrefab[2]);\n        // 将新增的节点添加到 Canvas 节点下面\n\n        shadowObj.scaleX = 1;\n        shadowObj.sacleY = 1;\n        shadowObj.active = false;\n        this.node.addChild(shadowObj);\n        return shadowObj;\n    },\n\n    setClickItem: function (select) {\n        this.clickSele = select;\n    },\n\n    putClickItem: function (selCard, node, pt) {\n        var putNode = cc.instantiate(node);\n        var innerId = this.nick +\"_\"+ Number(new Date());\n\n        putNode.x = pt.x;\n        putNode.y = pt.y;\n        putNode.name = innerId;\n        putNode.active = true;\n        selCard.addChild(putNode);\n\n        this.putSele[innerId] = putNode;\n\n        return innerId;\n    },\n\n    setDragItem: function (params, node) {\n        var card = params.target;\n        var dragNode = cc.instantiate(node);\n        var innerId = this.nick +\"_\"+ Number(new Date());\n\n        node.x = 0;\n        node.y = 0;\n        dragNode.name = innerId;\n        dragNode.actvie = true;\n        card.addChild(dragNode);\n\n        this.putSele[innerId] = dragNode;\n        this.draggingItem = innerId;\n\n        return innerId;\n    },\n\n    unsetDragItem: function (innerId) {\n        this.unshowDragMask();\n        this.draggingItem = \"\";\n        this.putSele[innerId].destroy();\n        this.putSele[innerId] = null;     \n    },\n\n    moveDragItem: function(sel, delta) {\n        if(this.putSele[this.draggingItem]) {\n            this.putSele[this.draggingItem].x += delta.x;\n            this.putSele[this.draggingItem].y += delta.y;   \n            \n            if(this.putSele[this.draggingItem].y < 0) {\n                //this.putSele[this.draggingItem].y = 0\n            }\n        }\n    },\n\n    clearDragItem: function(param, select) {\n        var innerId;\n        var card = param.target;\n        var sel = card._name;\n        var pt={};\n        var layoutPt = this.node.position;\n        var yOffset=0;\n        var magicCost = select.magicCost;\n        var level = select.level;\n        var role = select.role;\n\nconsole.log(\"role:\" + role);\n\n        this.unshowDragMask();\n\n        if(this.mainPlayer==1) {\n            yOffset=-50;\n        } else {\n            yOffset=20;\n        }\n\n        if(this.putSele[this.draggingItem]) {\n            innerId = this.putSele[this.draggingItem].name;\n\n            //layout maybe scaled according to devices.\n            pt.x = (this.putSele[this.draggingItem].x+card.x-layoutPt.x)/this.node.scaleX;\n            pt.y = (this.putSele[this.draggingItem].y+card.y-layoutPt.y+yOffset)/this.node.scaleY;\n\n            if(!this.isValidPutPoint(pt) && !this.ifNotMaskRole(role)) {\n                console.log(\"invalid postion.\");\n                this.putSele[innerId].destroy();\n                this.putSele[innerId] = null;\n                this.putErrorMsg();\n                return;\n            }\n\n            this.sendSodier(magicCost, role, pt, innerId, level);\n            this.draggingItem = \"\";\n        } \n    },\n\n    sendSodier: function(magicCost, role, pt, innerId, level) {\n        //var innerId = this.nick +\"_\"+ Number(new Date());\n        var isHero = (this.mainPlayer==1);\n        var bar = this.canvasNode.getChildByName(\"magicBar\");\n        var juice = bar.getChildByName(\"juice\");\n        var cost = this.useMagic(magicCost);\n\n        this.playSnd(\"put1\");\n\n        if(cost) {\n            juice.width = cost;\n            MY_SOCKET.json.emit('cmd', {'isHero':isHero, 'roomId': this.roomId, 'innerId': innerId, 'role': role, 'pt':pt, 'level':level});\n        } else {\n            this.putSele[innerId].destroy();\n            this.putSele[innerId] = null;            \n        }\n    },\n\n    setMagicBar: function() {\n        var bar = this.canvasNode.getChildByName(\"magicBar\");\n        var juice = bar.getChildByName(\"juice\");\n\n        if(juice.width<600) {\n            juice.width+=this.addJuice;\n        }\n\n        if(juice.width%50 == 0) {\n            this.magicAmount = juice.width/50;\n            this.updateCardStatus();\n        }\n    },\n\n    useMagic: function(amount) {\n        var bar = this.canvasNode.getChildByName(\"magicBar\");\n        var juice = bar.getChildByName(\"juice\");\n        var afterUse = juice.width-amount*50;\n\n        if(afterUse>=0) {\n            return afterUse;\n        }\n        return false;\n    },\n\n    updateCardStatus: function() {\n        var head = \"sel\";\n        var nodeName, selNode;\n        var selSprite = null;\n\n        for(var i=1;i<=7;i++) {\n            nodeName = head + i;\n            selNode = this.canvasNode.getChildByName(nodeName);\n            if(selNode) {\n                selSprite = selNode.getComponent('SelCard');\n                if(selSprite) {\n                    if(selSprite.magicCost <= this.magicAmount) {\n                        selNode.color = new cc.Color(255,255,255);\n                    } else {\n                        selNode.color = new cc.Color(127,127,127);\n                    }\n                }                \n            }\n        }\n    }\n});\n"]}