{"version":3,"sources":["assets/scripts/SelLayout.js"],"names":["String","prototype","inArray","arr","console","log","i","k","length","cc","Class","Component","properties","playerPrefab","type","Prefab","startBut1","Button","startBut2","startBut3","onLoad","_self","getComponent","interactable","choosenCard","allCardNodes","myCardNodes","agentsDef","getPersistantData","node","on","Node","EventType","TOUCH_END","params","unselect","find","dataobj","username","getName","baseRoles","wxRelayTime","httpPost","then","data","JSON","parse","setData","setMyCards","setAllCards","setScore","setUser","setTimeout","err","start","isUpgrade","getRandomCharName","aphabets","nick","Math","floor","random","myscore","nextscore","wallNode","getChildByName","myScoreLabel","nextScoreLabel","string","wonode","userLabel","levelLabel","name","level","sx","sy","mx","my","card","cardNode","cost","moveTo","allCards","myList","rowItems","rows","cols","instantiate","setRole","push","v2","setPosition","addChild","setRelayUI","role","CC_WECHATGAME","wx","shareAppMessage","title","imageUrl","Date","getTime","ifWxValidRelay","cur","seleOneCard","seleRole","grey","shakeMyCards","dispWxRelayWarn","flag","warn","active","getNowAgents","cNodes","_children","tn","ret","agentsList","ad","_name","magicCost","roleLevel","setMyList","param","getData","setCardsStatus","nowAgents","sumMyCards","sumCost","average","averageLabel","myCardsNumLabel","allCardsNumLabel","setCardStatus","toFixed","startCardJitter","stopCardJitter","disp","icon","allList","scaleX","scaleY"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\n// 定义一个判断函数\nString.prototype.inArray = function(arr){  \n    // 不是数组则抛出异常\n    if(!arr){\n         console.log(\"ERR(in_array):Input is not an array\");\n    }\n    // 遍历是否在数组中\n    for(var i=0,k=arr.length;i<k;i++){\n        if(this==arr[i]) {\n            return true;  \n        }\n    }\n    // 如果不在数组中就会返回false\n    return false;\n};\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        // 这个属性引用了预制资源\n        playerPrefab: {\n            default: [],\n            type: cc.Prefab\n        },\n        startBut1: cc.Button,\n        startBut2: cc.Button,\n        startBut3: cc.Button,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    onLoad () {\n        var _self = this;\n        this.startBut1.getComponent(cc.Button).interactable = false;\n        this.startBut2.getComponent(cc.Button).interactable = false;\n        this.startBut3.getComponent(cc.Button).interactable = false;\n\n        var choosenCard = {};\n\n        this.allCardNodes = [];\n        this.myCardNodes = [];\n\n        this.agentsDef = this.getPersistantData();\n\n        this.node.on(cc.Node.EventType.TOUCH_END, function (params) {\n            _self.unselect();\n        });\n\n        var node = cc.find('GameData').getComponent('GameData');\n        var dataobj;\n        this.username = node.getName();\n\n        //default roles for a user. other may need to get via video or relay.\n        this.baseRoles = [\"bee\",\"ske\",\"ir\",\"lr\",\"log\",\"lm\",\"hr\"];\n        this.wxRelayTime;\n\n        node.httpPost(this.username, \"\").then((data) => {\n            console.log(\"------------GameData------------------\");\n            console.log(data);\n            dataobj = JSON.parse(data);\n            _self.agentsDef = dataobj;\n            node.setData(dataobj);\n            _self.setMyCards();\n            _self.setAllCards();\n            _self.setScore();\n            _self.setUser();\n\n            setTimeout(function() {\n                _self.startBut1.getComponent(cc.Button).interactable = true; \n                _self.startBut2.getComponent(cc.Button).interactable = true; \n                _self.startBut3.getComponent(cc.Button).interactable = true; \n            }, 2000);\n        }, (err) => {   //if no connection then use default data for test.\n            _self.setMyCards();\n            _self.setAllCards();\n            _self.setScore();\n            _self.setUser();\n            _self.startBut1.getComponent(cc.Button).interactable = true;\n            _self.startBut2.getComponent(cc.Button).interactable = true;\n            _self.startBut3.getComponent(cc.Button).interactable = true;\n        });\n\n\n    },\n\n    start () {\n        var node = cc.find('GameData').getComponent('GameData');\n        console.log(\"upgraded:\" + node.isUpgrade);\n\n\n/*\n        var _self = this;\n        //var name = this.getRandomCharName();\n        var node = cc.find('GameData').getComponent('GameData');\n        var dataobj;\n        this.username = node.getName();\n\n        node.httpPost(this.username, \"\").then((data) => {\n            console.log(\"------------GameData------------------\");\n            console.log(data);\n            dataobj = JSON.parse(data);\n            _self.agentsDef = dataobj;\n            node.setData(dataobj);\n            _self.setMyCards();\n            _self.setAllCards();\n            _self.setScore();\n            _self.setUser();\n\n            _self.startBut1.getComponent(cc.Button).interactable = true;\n        }, (err) => {   //if no connection then use default data for test.\n            _self.setMyCards();\n            _self.setAllCards();\n            _self.setScore();\n            _self.setUser();\n        });\n*/\n    },\n\n    getRandomCharName: function() {\n        var aphabets =[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\",\"p\",\"q\",\"r\",\"s\",\"t\",\"u\",\"v\",\"w\",\"x\",\"y\",\"z\"];\n        var nick = \"\";\n        for(var i=0;i<6;i++) {\n            nick += aphabets[Math.floor(Math.random()*aphabets.length)];\n        } \n        return nick;\n    },\n\n    setScore: function() {\n        var myscore = this.agentsDef.myscore;\n        var nextscore = this.agentsDef.nextscore;\n\n        var wallNode = this.node.getChildByName(\"clanWall\");\n        var myScoreLabel = wallNode.getChildByName(\"wordbg\").getChildByName(\"myScore\").getComponent(\"cc.Label\");\n        var nextScoreLabel = wallNode.getChildByName(\"wordbg\").getChildByName(\"nextScore\").getComponent(\"cc.Label\");\n\n        myScoreLabel.string = myscore;\n        nextScoreLabel.string = \"/\" + nextscore;\n    },\n\n    setUser: function() {\n        var wonode = this.node.getChildByName(\"wobanner\");\n        var userLabel = wonode.getChildByName(\"username\").getComponent(\"cc.Label\");\n        var levelLabel = wonode.getChildByName(\"userlevel\").getComponent(\"cc.Label\");\n\n        userLabel.string = this.agentsDef.name;\n        levelLabel.string = this.agentsDef.level;\n    },\n\n    setMyCards: function() {\n        var sx = -295;\n        var sy = 24;\n        var mx, my;\n        var card, cardNode, cost, level;\n        var moveTo;\n        var allCards = this.agentsDef.myList;\n        var rowItems = 0;\n        var rows = 0;\n        var cols = 0;\n        var wallNode = this.node.getChildByName(\"clanWall\");\n/*\n        for(var i=0;i<6;i++) {\n            cols = i%6;\n            mx = sx+(cols*124);\n            my = sy;\n            card = cc.instantiate(this.playerPrefab[2]);\n            moveTo = cc.v2(mx, my);\n            card.setPosition(moveTo);\n            wallNode.addChild(card);\n        }\n*/\n        for(var i=0;i<6;i++) {\n            card = cc.instantiate(this.playerPrefab[1]);\n            cardNode = card.getComponent('SelCard');\n            if(allCards[i]) {\n                cost = this.agentsDef[allCards[i]].cost;\n                level = this.agentsDef.level;\n                cardNode.setRole(allCards[i], cost, level);\n            }\n\n            this.myCardNodes.push(cardNode);                \n            cols = i%6;\n            mx = sx+(cols*124);\n            my = sy;\n            moveTo = cc.v2(mx, my);\n            card.setPosition(moveTo);\n            wallNode.addChild(card);\n        }\n    },\n\n    setRelayUI: function(role) {\n        if (CC_WECHATGAME && !role.inArray(this.baseRoles)) {    //if wechat platform\n            wx.shareAppMessage({\n                title: \"中古战纪\",\n                imageUrl: \"https://www.asobee.mobi/fftower/res/acLogo2.jpg\"\n            })\n            this.wxRelayTime = new Date().getTime();\n        }\n    },\n\n    ifWxValidRelay: function() {\n        var cur = new Date().getTime();\n        if (cur - this.wxRelayTime < 3000) {\n            return false;\n        }\n        return true;\n    },\n\n    seleOneCard: function(role) {\n        var card;\n        for(var i=0;i<this.allCardNodes.length;i++) {\n            card = this.allCardNodes[i];\n            if(card.seleRole !== role) {\n                this.choosenCard = this.agentsDef[role];\n                this.choosenCard.role = role;\n                card.grey(true);\n            }\n        }\n        this.shakeMyCards(true);\n        this.setRelayUI(role);\n        this.dispWxRelayWarn(false);\n    },\n\n    dispWxRelayWarn: function(flag) {\n        var warn = this.node.getChildByName(\"wxRelayWarn\");\n        warn.active = flag;\n    },\n\n    getNowAgents: function() {\n        var cNodes = this.node.getChildByName(\"clanWall\")._children;\n        var tn;\n        var ret = [];\n        var agentsList = [];\n        var ad = {};\n        var role, cost, level;\n        for(var i=0;i<cNodes.length;i++) {\n            if(cNodes[i]._name == \"SelCard\") {\n                role = cNodes[i].getComponent(\"SelCard\").seleRole;\n                cost = cNodes[i].getComponent(\"SelCard\").magicCost;\n                level = cNodes[i].getComponent(\"SelCard\").roleLevel;\n\n                if(cost > 0) {\n                    ad = {\"seleRole\":role, \"magicCost\":cost, \"roleLevel\":level};\n                    agentsList.push(role);\n                    ret.push(ad);                    \n                }\n            }\n        }\n\n        var node = cc.find('GameData').getComponent('GameData');\n        node.setMyList(agentsList);\n        return ret;\n    },\n\n    getPersistantData: function(param) {\n        var node = cc.find('GameData').getComponent('GameData');\n        return node.getData();\n    },\n\n    setCardsStatus: function(nowAgents) {\n        var card;\n        var sumMyCards = 0;\n        var sumCost = 0;\n        var average = 0;\n        var wallNode = this.node.getChildByName(\"clanWall\");\n        var averageLabel = wallNode.getChildByName(\"wordboardbg\").getChildByName(\"averageCos\").getComponent(\"cc.Label\")\n        var myCardsNumLabel = wallNode.getChildByName(\"wordbg\").getChildByName(\"cardBut\").getChildByName(\"myCardNum\").getComponent(\"cc.Label\")\n        var allCardsNumLabel = wallNode.getChildByName(\"wordbg\").getChildByName(\"cardBut\").getChildByName(\"allCardNum\").getComponent(\"cc.Label\")\n\n        for(var i=0;i<this.allCardNodes.length;i++) {\n            card = this.allCardNodes[i];\n            card.setCardStatus(card.seleRole.inArray(nowAgents));\n        }\n\n        //for average magicCost display\n        for(var i=0;i<this.myCardNodes.length;i++) {\n            if(this.myCardNodes[i].magicCost !=0) {\n                sumMyCards++;\n                sumCost += this.myCardNodes[i].magicCost;\n            }\n        }\n\n        average = sumCost/sumMyCards;\n        averageLabel.string = average.toFixed(2);\n\n        //我的兵牌显示\n        myCardsNumLabel.string = sumMyCards;\n        allCardsNumLabel.string = \"/\" + this.allCardNodes.length;\n    },\n\n    shakeMyCards: function(flag) {\n        var card;\n        for(var i=0;i<this.myCardNodes.length;i++) {\n            card = this.myCardNodes[i];\n            if(flag) {\n                card.startCardJitter();\n            } else {\n                card.stopCardJitter();\n            }\n        }\n    },\n\n    unselect: function() {\n        var card;\n        this.choosenCard = {};\n        for(var i=0;i<this.allCardNodes.length;i++) {\n            card = this.allCardNodes[i];\n            card.grey(false);\n        }\n        this.shakeMyCards(false);\n//this.dispWxRelayWarn(false);\n    },\n\n    setAllCards: function() {\n        var sx = -200;\n        var sy = -400;\n        var mx, my;\n        var card, cardNode, cost, disp, icon;\n        var moveTo;\n        var allCards = this.agentsDef.allList;\n        var rowItems = 0;\n        var rows = 0;\n        var cols = 0;\n\n        for(var i=0;i<allCards.length;i++) {\n            cost = this.agentsDef[allCards[i]].cost;\n            disp = this.agentsDef[allCards[i]].disp;\n            rows = Math.floor(i/4);\n            cols = i%4;\n\n            my = sy-(rows*200);\n            mx = sx+(cols*170);\n\n            card = cc.instantiate(this.playerPrefab[0]);\n            cardNode = card.getComponent('AllCard');\n            cardNode.setRole(allCards[i], cost, disp);\n\n            if(CC_WECHATGAME && !allCards[i].inArray(this.baseRoles)) {\n                icon = cc.instantiate(this.playerPrefab[3]);\n                icon.setPosition(cc.v2(38,68));\n                icon.scaleX = 0.6;\n                icon.scaleY = 0.6;\n                card.addChild(icon);\n            }\n\n            moveTo = cc.v2(mx, my);\n            card.setPosition(moveTo);\n\n            this.allCardNodes.push(cardNode);\n            this.node.addChild(card);\n        }\n\n        this.setCardsStatus(this.agentsDef.myList);\n    },\n\n    // update (dt) {},\n});\n"]}