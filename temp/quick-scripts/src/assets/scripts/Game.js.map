{"version":3,"sources":["assets/scripts/Game.js"],"names":["common","require","gameProvider","cc","_Dictionary","Class","properties","playerPrefab","type","Prefab","audios","AudioClip","ctor","console","log","bufferLen","goback","event","customEventData","syncTimeout","director","loadScene","onLoad","_parent","netErrDisp","size","visibleRect","name","getRandomCharName","nick","canvasNode","node","parent","resultOp","getChildByName","getComponent","gameCountDown","mainPlayer","roomId","baseAttackDuraRec","agentMoveStepRec","_defaultBases","gameStartTime","gameCycleTime","gameOver","addJuice","npcInfo","removedNpcInfo","setUser","getPersistantData","socketHandle","putSele","dragingItem","clickSele","magicAmount","maskType","canvasPt","getPosition","layoutPt","cnode","pl","magicCost","role","selParams","selNode","innerId","on","Node","EventType","TOUCH_END","params","pt","getLocation","clickProcessor","initEventListener","crabNode","instantiate","x","y","addChild","find","getData","def","titlenode","levelLabel","nameLabel","scoreLabel","string","getNick","level","myscore","setConnFailInfo","msgLabel","retBut","active","setBuffDisp","buffType","setParam","param","timestamp","curTime","Date","getTime","setMyCards","dispCharSele","sx","sy","mx","my","card","cardNode","cost","moveTo","allCards","rowItems","rows","cols","head","i","length","_name","setRole","seleRole","roleLevel","v2","setPosition","charSele","zIndex","gameOverProcessor","data","win","killBases","clickPt","pt1","undefined","selCard","target","yOffset","scaleX","scaleY","ifNotMaskRole","showMask","isValidPutPoint","putErrorMsg","putClickItem","sendSodier","point","onEventEffect","bind","setCountDown","counter","min","parseInt","sec","timeNode","cdNode","doubleMagicDisp","dispnode","setTimeCounter","cnt","gameNowTime","setMagicBar","count_down","tens","ones","startTraceTimer","interval","then","now","game_cycle","game_cycle_then","cycle_cnt","traceTimer","delta","game_cycle_delta","Math","abs","mainGameCycle","schedule","agents","bullets","bases","forts","rollLogs","agentsFuture","fortsFuture","gameTraceStack","shift","playBullets","playLogs","playAgents","playBases","playForts","bulletProcess","logProcess","agentProcess","fortProcess","baseProcess","stopTraceTimer","MY_SOCKET","disconnect","unschedule","playSnd","sndType","audioEngine","play","playEffect","bd","startSceneJitter"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAIA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIC,YAAY,GAAGD,OAAO,CAAC,cAAD,CAA1B;;AACAE,EAAE,CAACC,WAAH,GAAiBH,OAAO,CAAC,YAAD,CAAxB;AAEAE,EAAE,CAACE,KAAH,CAAS;AACL,aAASH,YADJ;AAGLI,EAAAA,UAAU,EAAE;AACR;AACAC,IAAAA,YAAY,EAAE;AACV,iBAAS,EADC;AAEVC,MAAAA,IAAI,EAAEL,EAAE,CAACM;AAFC,KAFN;AAMRC,IAAAA,MAAM,EAAE;AACJ,iBAAS,EADL;AAEJF,MAAAA,IAAI,EAAEL,EAAE,CAACQ;AAFL;AANA,GAHP;AAeLC,EAAAA,IAfK,kBAeE;AACHC,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACA,SAAKC,SAAL,GAAiB,EAAjB;AACH,GAlBI;AAoBLC,EAAAA,MAAM,EAAE,gBAAUC,KAAV,EAAiBC,eAAjB,EAAkC;AACtC,SAAKC,WAAL;AACAhB,IAAAA,EAAE,CAACiB,QAAH,CAAYC,SAAZ,CAAsB,SAAtB;AACH,GAvBI;AAyBLC,EAAAA,MAAM,EAAE,kBAAY;AAChBT,IAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ;AAER;;;;;;;;;;;;;;;;;;;AAmBQ,QAAIS,OAAO,GAAG,IAAd;;AACA,SAAKC,UAAL,GAAkB,KAAlB;AACA,QAAIC,IAAI,GAAGtB,EAAE,CAACuB,WAAd;AACA,QAAIC,IAAI,GAAG,KAAKC,iBAAL,EAAX;AACA,SAAKC,IAAL,GAAYF,IAAZ;AAEA,SAAKG,UAAL,GAAkB,KAAKC,IAAL,CAAUC,MAA5B;AACA,SAAKC,QAAL,GAAgB,KAAKF,IAAL,CAAUG,cAAV,CAAyB,QAAzB,EAAmCC,YAAnC,CAAgD,QAAhD,CAAhB;AAEA,SAAKC,aAAL,GAAqB,GAArB,CA/BgB,CA+BU;AAC1B;;AACA,SAAKC,UAAL,GAAkB,CAAC,CAAnB;AACA,SAAKC,MAAL,GAAc,EAAd;AAEA,SAAKC,iBAAL,GAAyB,EAAzB;AACA,SAAKC,gBAAL,GAAwB,EAAxB;AACA,SAAKC,aAAL,GAAqB,CAAC,OAAD,EAAS,OAAT,EAAiB,OAAjB,EAAyB,OAAzB,EAAiC,OAAjC,EAAyC,OAAzC,CAArB;AAEA,SAAKC,aAAL,GAAqB,CAArB;AACA,SAAKC,aAAL,GAAqB,EAArB;AACA,SAAKC,QAAL,GAAc,KAAd;AACA,SAAKC,QAAL,GAAgB,EAAhB,CA3CgB,CA2CK;;AAErB,SAAKC,OAAL,GAAe,IAAI3C,EAAE,CAACC,WAAP,EAAf;AACA,SAAK2C,cAAL,GAAsB,IAAI5C,EAAE,CAACC,WAAP,EAAtB;AACA,SAAK4C,OAAL,CAAa,KAAKC,iBAAL,EAAb;AAEApC,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAUa,IAAtB;AACA,SAAKuB,YAAL,CAAkB,KAAKrB,IAAvB;AAEA,SAAKsB,OAAL,GAAe,EAAf;AACA,SAAKC,WAAL,GAAmB,EAAnB;AAEA,SAAKC,SAAL,GAAiB,EAAjB;AACA,SAAKC,WAAL,GAAmB,CAAnB,CAxDgB,CA0DhB;;AACA,SAAKC,QAAL,GAAgB,WAAhB;;AAEA,QAAIC,QAAQ,GAAG,KAAKzB,IAAL,CAAUR,OAAV,CAAkBkC,WAAlB,EAAf;;AACA,QAAIC,QAAQ,GAAG,KAAK3B,IAAL,CAAU0B,WAAV,EAAf;AACA,QAAIE,KAAJ,EAAWC,EAAX;AACA,QAAIC,SAAS,GAAG,CAAhB;AACA,QAAIC,IAAJ;AACA,QAAIC,SAAJ,EAAeC,OAAf;AACA,QAAIC,OAAJ;AAEA,SAAKlC,IAAL,CAAUmC,EAAV,CAAa/D,EAAE,CAACgE,IAAH,CAAQC,SAAR,CAAkBC,SAA/B,EAA0C,UAAUC,MAAV,EAAkB;AACxD,UAAG/C,OAAO,CAACmB,aAAR,IAAyB,CAA5B,EAA+B;AAC3B;AACH;;AACD,UAAI6B,EAAE,GAAGD,MAAM,CAACE,WAAP,EAAT;;AACAjD,MAAAA,OAAO,CAACkD,cAAR,CAAuBF,EAAvB;AACH,KAND;AAQR;;;;;;;;;;;AAWQ,SAAKG,iBAAL;AAIA,QAAIC,QAAQ,GAAGxE,EAAE,CAACyE,WAAH,CAAe,KAAKrE,YAAL,CAAkB,EAAlB,CAAf,CAAf;AACAoE,IAAAA,QAAQ,CAACE,CAAT,GAAa,GAAb;AACAF,IAAAA,QAAQ,CAACG,CAAT,GAAa,GAAb;AACA,SAAK/C,IAAL,CAAUgD,QAAV,CAAmBJ,QAAnB;AAGH,GA3HI;AA6HL1B,EAAAA,iBAAiB,EAAE,6BAAW;AAC1B,QAAIlB,IAAI,GAAG5B,EAAE,CAAC6E,IAAH,CAAQ,UAAR,EAAoB7C,YAApB,CAAiC,UAAjC,CAAX;AACA,WAAOJ,IAAI,CAACkD,OAAL,EAAP;AACH,GAhII;AAkILjC,EAAAA,OAAO,EAAE,iBAASkC,GAAT,EAAc;AACnB,QAAInD,IAAI,GAAG5B,EAAE,CAAC6E,IAAH,CAAQ,UAAR,EAAoB7C,YAApB,CAAiC,UAAjC,CAAX;AACA,QAAIgD,SAAS,GAAG,KAAKpD,IAAL,CAAUC,MAAV,CAAiBE,cAAjB,CAAgC,QAAhC,EAA0CA,cAA1C,CAAyD,OAAzD,CAAhB;AACA,QAAIkD,UAAU,GAAG,KAAKrD,IAAL,CAAUC,MAAV,CAAiBE,cAAjB,CAAgC,QAAhC,EAA0CA,cAA1C,CAAyD,OAAzD,EAAkEA,cAAlE,CAAiF,WAAjF,EAA8FC,YAA9F,CAA2G,UAA3G,CAAjB;AACA,QAAIkD,SAAS,GAAGF,SAAS,CAACjD,cAAV,CAAyB,MAAzB,EAAiCC,YAAjC,CAA8C,UAA9C,CAAhB;AACA,QAAImD,UAAU,GAAGH,SAAS,CAACjD,cAAV,CAAyB,OAAzB,EAAkCC,YAAlC,CAA+C,UAA/C,CAAjB;AAEAkD,IAAAA,SAAS,CAACE,MAAV,GAAmBxD,IAAI,CAACyD,OAAL,EAAnB;AACAJ,IAAAA,UAAU,CAACG,MAAX,GAAoBL,GAAG,CAACO,KAAxB;AACAH,IAAAA,UAAU,CAACC,MAAX,GAAoBL,GAAG,CAACQ,OAAxB;AACH,GA5II;AA8ILC,EAAAA,eAAe,EAAE,2BAAW;AACxB,SAAKnE,UAAL,GAAkB,IAAlB;AACA,QAAIoE,QAAQ,GAAG,KAAK7D,IAAL,CAAUG,cAAV,CAAyB,SAAzB,EAAoCA,cAApC,CAAmD,KAAnD,EAA0DC,YAA1D,CAAuE,UAAvE,CAAf;AACA,QAAI0D,MAAM,GAAG,KAAK9D,IAAL,CAAUG,cAAV,CAAyB,SAAzB,EAAoCA,cAApC,CAAmD,QAAnD,CAAb;AACA2D,IAAAA,MAAM,CAACC,MAAP,GAAgB,IAAhB;AACAF,IAAAA,QAAQ,CAACL,MAAT,GAAkB,SAAlB;AACH,GApJI;AAsJLQ,EAAAA,WAAW,EAAE,qBAASC,QAAT,EAAmB;AAC5B,QAAIlE,UAAU,GAAG,KAAKC,IAAL,CAAUC,MAA3B;AACA,SAAKgE,QAAL,GAAgBA,QAAhB;;AACA,QAAGA,QAAQ,IAAI,MAAf,EAAuB;AACnBlE,MAAAA,UAAU,CAACI,cAAX,CAA0B,UAA1B,EAAsC4D,MAAtC,GAA+C,IAA/C;AACH,KAFD,MAGK,IAAGE,QAAQ,IAAI,SAAf,EAA0B;AAC3BlE,MAAAA,UAAU,CAACI,cAAX,CAA0B,aAA1B,EAAyC4D,MAAzC,GAAkD,IAAlD;AACH;AACJ,GA/JI;;AAiKT;;;;;;;;AASIG,EAAAA,QAAQ,EAAE,kBAASC,KAAT,EAAgBC,SAAhB,EAA2B;AACjCtF,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACAD,IAAAA,OAAO,CAACC,GAAR,CAAYoF,KAAZ;AACArF,IAAAA,OAAO,CAACC,GAAR,CAAYqF,SAAZ;AAEA,QAAIC,OAAO,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAd;AAEAzF,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAesF,OAAO,GAAGD,SAAzB,CAAZ;AAEA,SAAKI,UAAL,CAAgBL,KAAhB;AACA,SAAKM,YAAL;AACH,GArLI;AAuLLD,EAAAA,UAAU,EAAE,oBAASL,KAAT,EAAgB;AACxB,QAAIO,EAAE,GAAG,CAAC,GAAV;AACA,QAAIC,EAAE,GAAG,CAAC,GAAV;AACA,QAAIC,EAAJ,EAAQC,EAAR;AACA,QAAIC,IAAJ,EAAUC,QAAV,EAAoBC,IAApB;AACA,QAAIC,MAAJ,CALwB,CAMxB;;AACA,QAAIC,QAAQ,GAAGf,KAAf;AACA,QAAIgB,QAAQ,GAAG,CAAf;AACA,QAAIC,IAAI,GAAG,CAAX;AACA,QAAIC,IAAI,GAAG,CAAX;AACA,QAAItF,UAAU,GAAG,KAAKC,IAAL,CAAUC,MAA3B;AACA,QAAIqF,IAAI,GAAG,KAAX;;AAEA,SAAI,IAAIC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACL,QAAQ,CAACM,MAAvB,EAA8BD,CAAC,EAA/B,EAAmC;AAC/BT,MAAAA,IAAI,GAAG1G,EAAE,CAACyE,WAAH,CAAe,KAAKrE,YAAL,CAAkB,EAAlB,CAAf,CAAP;AACAsG,MAAAA,IAAI,CAACW,KAAL,GAAaH,IAAI,IAAIC,CAAC,GAAC,CAAN,CAAjB;AACAR,MAAAA,QAAQ,GAAGD,IAAI,CAAC1E,YAAL,CAAkB,SAAlB,CAAX;;AACA,UAAG8E,QAAQ,CAACK,CAAD,CAAX,EAAgB;AACZP,QAAAA,IAAI,GAAG,CAAP;AACAD,QAAAA,QAAQ,CAACW,OAAT,CAAiBR,QAAQ,CAACK,CAAD,CAAR,CAAYI,QAA7B,EAAuCT,QAAQ,CAACK,CAAD,CAAR,CAAYzD,SAAnD,EAA8DoD,QAAQ,CAACK,CAAD,CAAR,CAAYK,SAA1E;AACH,OAP8B,CAS/B;;;AACAP,MAAAA,IAAI,GAAGE,CAAC,GAAC,CAAT;AACAX,MAAAA,EAAE,GAAGF,EAAE,GAAEW,IAAI,GAAC,GAAd;AACAR,MAAAA,EAAE,GAAGF,EAAL;AACAM,MAAAA,MAAM,GAAG7G,EAAE,CAACyH,EAAH,CAAMjB,EAAN,EAAUC,EAAV,CAAT;AACAC,MAAAA,IAAI,CAACgB,WAAL,CAAiBb,MAAjB;AACAlF,MAAAA,UAAU,CAACiD,QAAX,CAAoB8B,IAApB;AACH;;AAED,SAAI,IAAIS,CAAC,GAACL,QAAQ,CAACM,MAAnB,EAA0BD,CAAC,GAAC,CAA5B,EAA8BA,CAAC,EAA/B,EAAmC;AAC/BF,MAAAA,IAAI,GAAGE,CAAC,GAAC,CAAT;AACAX,MAAAA,EAAE,GAAGF,EAAE,GAAEW,IAAI,GAAC,GAAd;AACAR,MAAAA,EAAE,GAAGF,EAAL;AACAG,MAAAA,IAAI,GAAG1G,EAAE,CAACyE,WAAH,CAAe,KAAKrE,YAAL,CAAkB,EAAlB,CAAf,CAAP;AACAyG,MAAAA,MAAM,GAAG7G,EAAE,CAACyH,EAAH,CAAMjB,EAAN,EAAUC,EAAV,CAAT;AACAC,MAAAA,IAAI,CAACgB,WAAL,CAAiBb,MAAjB;AACAlF,MAAAA,UAAU,CAACiD,QAAX,CAAoB8B,IAApB;AACH;AACJ,GAhOI;AAkOLL,EAAAA,YAAY,EAAE,wBAAW;AACrB,QAAIsB,QAAQ,GAAG,KAAK/F,IAAL,CAAUC,MAAV,CAAiBE,cAAjB,CAAgC,UAAhC,CAAf;AACA4F,IAAAA,QAAQ,CAACC,MAAT,GAAkB,IAAlB;AACAD,IAAAA,QAAQ,CAAChC,MAAT,GAAkB,KAAlB;AACAjF,IAAAA,OAAO,CAACC,GAAR,CAAYgH,QAAZ;AACH,GAvOI;AAyOLE,EAAAA,iBAAiB,EAAC,2BAAS3F,UAAT,EAAqB4F,IAArB,EAA2B;AACzC,QAAG5F,UAAU,IAAI,CAAjB,EAAoB;AAChB,UAAG4F,IAAI,CAACC,GAAL,IAAY,CAAf,EAAkB;AACdrH,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACA,aAAKqH,SAAL,CAAe,IAAf;AACH,OAHD,MAIK,IAAGF,IAAI,CAACC,GAAL,IAAY,CAAf,EAAkB;AACnBrH,QAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACA,aAAKqH,SAAL,CAAe,MAAf;AACH;AACJ,KATD,MAUK,IAAG9F,UAAU,IAAI,CAAjB,EAAoB;AACrB,UAAG4F,IAAI,CAACC,GAAL,IAAY,CAAf,EAAkB;AACdrH,QAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACA,aAAKqH,SAAL,CAAe,MAAf;AACH,OAHD,MAIK,IAAGF,IAAI,CAACC,GAAL,IAAY,CAAf,EAAkB;AACnBrH,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACA,aAAKqH,SAAL,CAAe,IAAf;AACH;AACJ;AACJ,GA9PI;AAgQL1D,EAAAA,cAAc,EAAC,wBAAU2D,OAAV,EAAmB;AAC9B,QAAI7G,OAAO,GAAG,IAAd;;AAEA,QAAIiC,QAAQ,GAAG,KAAK1B,UAAL,CAAgB2B,WAAhB,EAAf;AACA,QAAIC,QAAQ,GAAG,KAAK3B,IAAL,CAAU0B,WAAV,EAAf;AACA,QAAIQ,OAAJ,CAL8B,CAO9B;;AACA,QAAIM,EAAE,GAAG6D,OAAT;AACA,QAAIC,GAAG,GAAG,EAAV;AAEA,QAAIxE,SAAS,GAAGtC,OAAO,CAAC8B,SAAR,CAAkBQ,SAAlC;AACA,QAAI4B,KAAK,GAAGlE,OAAO,CAAC8B,SAAR,CAAkBoC,KAA9B;AACA,QAAI3B,IAAI,GAAGvC,OAAO,CAAC8B,SAAR,CAAkBS,IAA7B;;AAEA,QAAGA,IAAI,KAAKwE,SAAT,IAAsBxE,IAAI,IAAI,EAAjC,EAAqC;AACjC;AACH;;AAED,QAAIyE,OAAO,GAAGhH,OAAO,CAAC8B,SAAR,CAAkBiB,MAAlB,CAAyBkE,MAAvC;AACA,QAAIxE,OAAO,GAAGzC,OAAO,CAAC8B,SAAR,CAAkBtB,IAAhC;AAEA,QAAI6B,EAAE,GAAGI,OAAO,CAAChC,MAAR,CAAeyB,WAAf,EAAT,CAtB8B,CAsBU;;AACxC,QAAIgF,OAAJ;;AAEA,QAAGlH,OAAO,CAACc,UAAR,IAAoB,CAAvB,EAA0B;AACtBoG,MAAAA,OAAO,GAAC,CAAC,EAAT;AACH,KAFD,MAEO;AACHA,MAAAA,OAAO,GAAC,EAAR;AACH,KA7B6B,CA+B9B;;;AACAJ,IAAAA,GAAG,CAACxD,CAAJ,GAASnB,QAAQ,CAACmB,CAAT,GAAaN,EAAE,CAACM,CAAhB,GAAoBjB,EAAE,CAACiB,CAAxB,GAA2B,EAAnC;AACAwD,IAAAA,GAAG,CAACvD,CAAJ,GAASpB,QAAQ,CAACoB,CAAT,GAAaP,EAAE,CAACO,CAAhB,GAAoBlB,EAAE,CAACkB,CAAxB,IAA4BtB,QAAQ,CAACsB,CAAT,GAAapB,QAAQ,CAACoB,CAAlD,CAAR,CAjC8B,CAmC9B;;AACAP,IAAAA,EAAE,CAACM,CAAH,GAAON,EAAE,CAACM,CAAH,GAAKtD,OAAO,CAACQ,IAAR,CAAa2G,MAAlB,IAA4BlF,QAAQ,CAACqB,CAAT,GAAanB,QAAQ,CAACmB,CAAlD,CAAP;AACAN,IAAAA,EAAE,CAACO,CAAH,GAAOP,EAAE,CAACO,CAAH,GAAKvD,OAAO,CAACQ,IAAR,CAAa4G,MAAlB,IAA4BnF,QAAQ,CAACsB,CAAT,GAAapB,QAAQ,CAACoB,CAAlD,IAAuD2D,OAA9D;;AAEA,QAAG,CAAC,KAAKG,aAAL,CAAmB9E,IAAnB,CAAJ,EAA8B;AAC1B,WAAK+E,QAAL,CAAc,KAAKtF,QAAnB,EAA6B,CAA7B;AACH;;AAED,QAAG,CAAC,KAAKuF,eAAL,CAAqBvE,EAArB,CAAD,IAA6B,CAAC,KAAKqE,aAAL,CAAmB9E,IAAnB,CAAjC,EAA2D;AACvDjD,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACA,WAAKiI,WAAL;AACA;AACH;;AAED9E,IAAAA,OAAO,GAAG1C,OAAO,CAACyH,YAAR,CAAqBT,OAArB,EAA8BvE,OAA9B,EAAuCqE,GAAvC,CAAV;;AACA9G,IAAAA,OAAO,CAAC0H,UAAR,CAAmBpF,SAAnB,EAA8BC,IAA9B,EAAoCS,EAApC,EAAwCN,OAAxC,EAAiDwB,KAAjD;AACH,GAnTI;AAqTLqD,EAAAA,eAAe,EAAE,yBAASI,KAAT,EAAgB;AAC7B,QAAI3E,EAAE,GAAG,EAAT;AACAA,IAAAA,EAAE,CAACM,CAAH,GAAOqE,KAAK,CAACrE,CAAb;AACAN,IAAAA,EAAE,CAACO,CAAH,GAAOoE,KAAK,CAACpE,CAAb;;AACA,QAAG,KAAKzC,UAAL,IAAmB,CAAtB,EAAyB;AACrBkC,MAAAA,EAAE,CAACO,CAAH,GAAOoE,KAAK,CAACpE,CAAN,GAAQ,EAAf;AACH;;AAED,QAAG,KAAKvB,QAAL,IAAiB,WAApB,EAAiC;AAC7B,UAAGgB,EAAE,CAACM,CAAH,IAAQ,EAAR,IAAcN,EAAE,CAACM,CAAH,IAAQ,GAAtB,IAA6BN,EAAE,CAACO,CAAH,GAAO,CAApC,IAAyCP,EAAE,CAACO,CAAH,GAAO,GAAnD,EAAwD;AACpD,eAAO,IAAP;AACH,OAFD,MAEO;AACH,eAAO,KAAP;AACH;AACJ,KAND,MAOK,IAAG,KAAKvB,QAAL,IAAiB,YAApB,EAAkC;AACnC,UAAIgB,EAAE,CAACM,CAAH,IAAQ,EAAR,IAAcN,EAAE,CAACM,CAAH,IAAQ,GAAtB,IAA6BN,EAAE,CAACO,CAAH,GAAO,CAApC,IAAyCP,EAAE,CAACO,CAAH,GAAO,GAAjD,IAA0DP,EAAE,CAACM,CAAH,IAAQ,GAAR,IAAeN,EAAE,CAACM,CAAH,IAAQ,GAAvB,IAA8BN,EAAE,CAACO,CAAH,GAAO,GAArC,IAA4CP,EAAE,CAACO,CAAH,GAAO,GAAhH,EAAsH;AAClH,eAAO,IAAP;AACH,OAFD,MAEO;AACH,eAAO,KAAP;AACH;AACJ,KANI,MAOA,IAAG,KAAKvB,QAAL,IAAiB,YAApB,EAAkC;AACnC,UAAIgB,EAAE,CAACM,CAAH,IAAQ,EAAR,IAAcN,EAAE,CAACM,CAAH,IAAQ,GAAtB,IAA6BN,EAAE,CAACO,CAAH,GAAO,CAApC,IAAyCP,EAAE,CAACO,CAAH,GAAO,GAAjD,IAA0DP,EAAE,CAACM,CAAH,IAAQ,EAAR,IAAcN,EAAE,CAACM,CAAH,IAAQ,GAAtB,IAA6BN,EAAE,CAACO,CAAH,GAAO,GAApC,IAA2CP,EAAE,CAACO,CAAH,GAAO,GAA/G,EAAqH;AACjH,eAAO,IAAP;AACH,OAFD,MAEO;AACH,eAAO,KAAP;AACH;AACJ,KANI,MAOA,IAAG,KAAKvB,QAAL,IAAiB,WAApB,EAAiC;AAClC,UAAGgB,EAAE,CAACM,CAAH,IAAQ,EAAR,IAAcN,EAAE,CAACM,CAAH,IAAQ,GAAtB,IAA6BN,EAAE,CAACO,CAAH,GAAO,CAApC,IAAyCP,EAAE,CAACO,CAAH,GAAO,GAAnD,EAAwD;AACpD,eAAO,IAAP;AACH,OAFD,MAEO;AACH,eAAO,KAAP;AACH;AACJ;;AACD,WAAO,KAAP;AACH,GA1VI;AA4VL8D,EAAAA,aAAa,EAAE,uBAAU9E,IAAV,EAAgB;AAC3B,QAAGA,IAAI,IAAI,MAAR,IAAkBA,IAAI,IAAI,SAA1B,IAAwCA,IAAI,IAAI,MAAnD,EAA2D;AACvD,aAAO,IAAP;AACH;;AACD,WAAO,KAAP;AACH,GAjWI;AAmWLY,EAAAA,iBAAiB,EAAC,6BAAY;AAC1B,SAAK3C,IAAL,CAAUmC,EAAV,CAAa,cAAb,EAA6B,KAAKiF,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAA7B;AACH,GArWI;AAuWLD,EAAAA,aAAa,EAAC,yBAAW;AACrBtI,IAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ;AACH,GAzWI;AA2WLuI,EAAAA,YAAY,EAAC,sBAASC,OAAT,EAAkB;AAC3B,QAAIC,GAAG,GAAGC,QAAQ,CAACF,OAAO,GAAC,EAAT,CAAlB;AACA,QAAIG,GAAG,GAAGH,OAAO,GAAC,EAAlB,CAF2B,CAG3B;;AACA,QAAII,QAAQ,GAAG,KAAK5H,UAAL,CAAgBI,cAAhB,CAA+B,QAA/B,EAAyCA,cAAzC,CAAwD,MAAxD,CAAf;AACA,QAAIyH,MAAM,GAAGD,QAAQ,CAACxH,cAAT,CAAwB,WAAxB,EAAqCC,YAArC,CAAkD,UAAlD,CAAb;;AACA,QAAGsH,GAAG,GAAC,EAAP,EAAW;AACPA,MAAAA,GAAG,GAAG,MAAMA,GAAZ;AACH;;AACDE,IAAAA,MAAM,CAACpE,MAAP,GAAiBgE,GAAG,GAAE,GAAL,GAAUE,GAA3B;AACH,GArXI;AAuXLG,EAAAA,eAAe,EAAC,2BAAW;AACvB,QAAIC,QAAQ,GAAG,KAAK9H,IAAL,CAAUG,cAAV,CAAyB,aAAzB,CAAf;AACA2H,IAAAA,QAAQ,CAAC/D,MAAT,GAAkB,IAAlB;AACH,GA1XI;AA4XLgE,EAAAA,cAAc,EAAC,wBAASC,GAAT,EAAc;AACzB;AACA,SAAKC,WAAL,GAAmBD,GAAnB;AACA,SAAKV,YAAL,CAAkBU,GAAlB;;AACA,QAAGA,GAAG,IAAI,EAAV,EAAc;AACVlJ,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACA,WAAK8I,eAAL;AACA,WAAK/G,QAAL,GAAgB,EAAhB;AACH;;AAED,SAAKoH,WAAL,GAVyB,CAYzB;AACA;;AACA,QAAIC,UAAU,GAAG,KAAKvH,aAAL,GAAmBoH,GAApC;;AAEA,QAAGG,UAAU,GAAC,CAAd,EAAiB;AACb,WAAKtH,QAAL,GAAc,IAAd;AACA;AACH;;AAED,QAAIuH,IAAI,GAAGX,QAAQ,CAACU,UAAU,GAAC,EAAZ,CAAnB;AACA,QAAIE,IAAI,GAAGF,UAAU,GAAC,EAAtB,CAtByB,CAwBzB;AACH,GArZI;AAuZLG,EAAAA,eAAe,EAAC,2BAAW;AACvB;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACA,QAAIC,IAAI,GAAGlE,IAAI,CAACmE,GAAL,EAAX;;AACA,QAAIjJ,OAAO,GAAG,IAAd,CAJuB,CAMvB;;;AACA,QAAIkJ,UAAU,GAAG,KAAK9H,aAAL,GAAmB,IAApC;AACA,QAAI+H,eAAe,GAAGrE,IAAI,CAACmE,GAAL,EAAtB;AACA,QAAIG,SAAS,GAAG,CAAhB;;AAEA,QAAG,CAAC,KAAKC,UAAT,EAAqB;AACjB,WAAKA,UAAL,GAAkB,YAAW;AACzB,YAAIJ,GAAG,GAAGnE,IAAI,CAACmE,GAAL,EAAV;AACA,YAAIK,KAAK,GAAGL,GAAG,GAAGD,IAAlB,CAFyB,CAIzB;AACA;;AACA,YAAIO,gBAAgB,GAAGN,GAAG,GAAGjJ,OAAO,CAACmB,aAArC,CANyB,CAOzB;;AACA,YAAG,CAACnB,OAAO,CAACqB,QAAT,IAAqBkI,gBAAgB,GAAGH,SAAS,GAAC,IAArD,EAA2D;AACvDA,UAAAA,SAAS,GAD8C,CAGvD;;AACA,cAAGI,IAAI,CAACC,GAAL,CAASL,SAAS,GAACpJ,OAAO,CAACyI,WAA3B,IAA0C,CAA7C,EAAgD;AAC5C,iBAAK7I,WAAL;AACH;AACJ;;AAED,YAAG0J,KAAK,GAACtJ,OAAO,CAAC+I,QAAjB,EAA2B;AACvBC,UAAAA,IAAI,GAAGC,GAAG,GAAIK,KAAK,GAACtJ,OAAO,CAAC+I,QAA5B;;AACA/I,UAAAA,OAAO,CAAC0J,aAAR;AACH;AACJ,OArBiB,CAqBhB7B,IArBgB,CAqBX,IArBW,CAAlB;AAsBH;;AAED,SAAK8B,QAAL,CAAc,KAAKN,UAAnB,EAA8B,CAA9B;AACH,GA5bI;AA8bLK,EAAAA,aAAa,EAAC,yBAAW;AACrB,QAAI1J,OAAO,GAAG,IAAd;;AACA,QAAI0G,IAAJ,EAASkD,MAAT,EAAgBC,OAAhB,EAAwBC,KAAxB,EAA8BC,KAA9B,EAAoCC,QAApC,EAA6CC,YAA7C,EAA0DC,WAA1D;;AAEA,QAAG,KAAKC,cAAL,CAAoBnE,MAApB,GAA6B,KAAKxG,SAArC,EAAgD;AAC5C,WAAK2K,cAAL,CAAoBC,KAApB;AACA1D,MAAAA,IAAI,GAAG,KAAKyD,cAAL,CAAoB,CAApB,CAAP,CAF4C,CAG5C;;AACAP,MAAAA,MAAM,GAAGlD,IAAI,CAACkD,MAAd;AACAK,MAAAA,YAAY,GAAG,KAAKE,cAAL,CAAoB,EAApB,EAAwBP,MAAvC;AACAM,MAAAA,WAAW,GAAG,KAAKC,cAAL,CAAoB,EAApB,EAAwBJ,KAAtC;AACAF,MAAAA,OAAO,GAAGnD,IAAI,CAACmD,OAAf;AACAC,MAAAA,KAAK,GAAGpD,IAAI,CAACoD,KAAb;AACAC,MAAAA,KAAK,GAAGrD,IAAI,CAACqD,KAAb;AACAC,MAAAA,QAAQ,GAAGtD,IAAI,CAACsD,QAAhB;;AAEAhK,MAAAA,OAAO,CAACqK,WAAR,CAAoBR,OAApB;;AACA7J,MAAAA,OAAO,CAACsK,QAAR,CAAiBN,QAAjB;;AAEAhK,MAAAA,OAAO,CAACuK,UAAR,CAAmBX,MAAnB,EAA2BK,YAA3B;;AACAjK,MAAAA,OAAO,CAACwK,SAAR,CAAkBV,KAAlB;;AACA9J,MAAAA,OAAO,CAACyK,SAAR,CAAkBV,KAAlB;;AAEA/J,MAAAA,OAAO,CAAC0K,aAAR,CAAsBb,OAAtB;;AACA7J,MAAAA,OAAO,CAAC2K,UAAR,CAAmBX,QAAnB;;AACAhK,MAAAA,OAAO,CAAC4K,YAAR,CAAqBhB,MAArB;;AACA5J,MAAAA,OAAO,CAAC6K,WAAR,CAAoBd,KAApB,EAA2BG,WAA3B;;AACAlK,MAAAA,OAAO,CAAC8K,WAAR,CAAoBhB,KAApB;AACH,KA5BoB,CA8BrB;AACA;AACA;;AACH,GA/dI;AAieLlK,EAAAA,WAAW,EAAC,uBAAW;AACnB,SAAKyB,QAAL,GAAc,IAAd;AACA,SAAK0J,cAAL;AACAC,IAAAA,SAAS,CAACC,UAAV;AAEA3L,IAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EALmB,CAMnB;AACH,GAxeI;AA0eLwL,EAAAA,cAAc,EAAC,0BAAW;AACtB,QAAG,KAAK1B,UAAR,EAAoB;AAChB,WAAK6B,UAAL,CAAgB,KAAK7B,UAArB;AACH;AACJ,GA9eI;AAgfL8B,EAAAA,OAAO,EAAC,iBAASC,OAAT,EAAkB;AACtB,QAAGA,OAAO,IAAI,MAAd,EAAsB;AAClBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFD,MAGK,IAAGiM,OAAO,IAAI,UAAd,EAA0B;AAC3BxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,MAAd,EAAsB;AACvBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,KAAd,EAAqB;AACtBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,IAAd,EAAoB;AACrBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,IAAd,EAAoB;AACrBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,IAAd,EAAoB;AACrBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,MAAd,EAAsB;AACvBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,SAAd,EAAyB;AAC1BxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,IAAd,EAAoB;AACrBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,KAAd,EAAqB;AACtBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,CAAZ,CAApB,EAAoC,KAApC,EAA2C,CAA3C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,SAAd,EAAyB;AAC1BxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,EAAZ,CAApB,EAAqC,KAArC,EAA4C,CAA5C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,MAAd,EAAsB;AACvBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,EAAZ,CAApB,EAAqC,KAArC,EAA4C,CAA5C;AACH,KAFI,MAGA,IAAGiM,OAAO,IAAI,KAAd,EAAqB;AACtBxM,MAAAA,EAAE,CAACyM,WAAH,CAAeC,IAAf,CAAoB,KAAKnM,MAAL,CAAY,EAAZ,CAApB,EAAqC,KAArC,EAA4C,CAA5C;AACH;AACJ,GA3hBI;AA6hBLoM,EAAAA,UAAU,EAAE,oBAAShJ,IAAT,EAAee,CAAf,EAAkBC,CAAlB,EAAqB;AAC7B,QAAIiI,EAAJ,CAD6B,CAE7B;AACA;;AACA,QAAGjJ,IAAI,IAAI,IAAX,EAAiB;AACbiJ,MAAAA,EAAE,GAAG5M,EAAE,CAACyE,WAAH,CAAe,KAAKrE,YAAL,CAAkB,EAAlB,CAAf,CAAL;AACAwM,MAAAA,EAAE,CAAClI,CAAH,GAAOA,CAAP;AACAkI,MAAAA,EAAE,CAACjI,CAAH,GAAOA,CAAC,GAAC,EAAT;AACA,WAAK/C,IAAL,CAAUgD,QAAV,CAAmBgI,EAAnB;AACH;;AACD,QAAGjJ,IAAI,IAAI,IAAX,EAAiB;AACb,WAAK4I,OAAL,CAAa,IAAb;AACAK,MAAAA,EAAE,GAAG5M,EAAE,CAACyE,WAAH,CAAe,KAAKrE,YAAL,CAAkB,EAAlB,CAAf,CAAL;AACAwM,MAAAA,EAAE,CAAClI,CAAH,GAAOA,CAAP;AACAkI,MAAAA,EAAE,CAACjI,CAAH,GAAOA,CAAC,GAAC,EAAT;AACA,WAAK/C,IAAL,CAAUgD,QAAV,CAAmBgI,EAAnB;AACH,KAND,MAOK,IAAGjJ,IAAI,IAAI,MAAX,EAAmB;AACpB,WAAK4I,OAAL,CAAa,MAAb;AACAK,MAAAA,EAAE,GAAG5M,EAAE,CAACyE,WAAH,CAAe,KAAKrE,YAAL,CAAkB,EAAlB,CAAf,CAAL;AACAwM,MAAAA,EAAE,CAAClI,CAAH,GAAOA,CAAP;AACAkI,MAAAA,EAAE,CAACjI,CAAH,GAAOA,CAAP;AACA,WAAK/C,IAAL,CAAUgD,QAAV,CAAmBgI,EAAnB;AACH,KANI,CAOL;AAPK,SAQA,IAAGjJ,IAAI,IAAI,IAAX,EAAiB;AAClBiJ,QAAAA,EAAE,GAAG5M,EAAE,CAACyE,WAAH,CAAe,KAAKrE,YAAL,CAAkB,EAAlB,CAAf,CAAL;AACAwM,QAAAA,EAAE,CAAClI,CAAH,GAAOA,CAAP;AACAkI,QAAAA,EAAE,CAACjI,CAAH,GAAOA,CAAP;AACA,aAAK/C,IAAL,CAAUgD,QAAV,CAAmBgI,EAAnB;AACH,OALI,MAMA,IAAGjJ,IAAI,IAAI,KAAX,EAAkB;AACnBiJ,QAAAA,EAAE,GAAG5M,EAAE,CAACyE,WAAH,CAAe,KAAKrE,YAAL,CAAkB,EAAlB,CAAf,CAAL;AACAwM,QAAAA,EAAE,CAACrE,MAAH,GAAY,GAAZ;AACAqE,QAAAA,EAAE,CAACpE,MAAH,GAAY,GAAZ;AACAoE,QAAAA,EAAE,CAAClI,CAAH,GAAOA,CAAC,GAAC,EAAT;AACAkI,QAAAA,EAAE,CAACjI,CAAH,GAAOA,CAAP;AACA,aAAK/C,IAAL,CAAUgD,QAAV,CAAmBgI,EAAnB;AACH,OAPI,MAQA,IAAGjJ,IAAI,IAAI,MAAX,EAAmB;AACpB,aAAK4I,OAAL,CAAa,MAAb,EADoB,CAEpB;;AACA,aAAKM,gBAAL;AACAD,QAAAA,EAAE,GAAG5M,EAAE,CAACyE,WAAH,CAAe,KAAKrE,YAAL,CAAkB,CAAlB,CAAf,CAAL;AACAwM,QAAAA,EAAE,CAACjH,MAAH,GAAY,IAAZ;AACAiH,QAAAA,EAAE,CAAClI,CAAH,GAAOA,CAAP;AACAkI,QAAAA,EAAE,CAACjI,CAAH,GAAOA,CAAP;AACA,aAAK/C,IAAL,CAAUgD,QAAV,CAAmBgI,EAAnB;AACH,OATI,MAUA,IAAGjJ,IAAI,IAAI,SAAX,EAAsB;AACvB,aAAK4I,OAAL,CAAa,SAAb;AACAK,QAAAA,EAAE,GAAG5M,EAAE,CAACyE,WAAH,CAAe,KAAKrE,YAAL,CAAkB,EAAlB,CAAf,CAAL;AACAwM,QAAAA,EAAE,CAACjH,MAAH,GAAY,IAAZ;AACAiH,QAAAA,EAAE,CAAClI,CAAH,GAAOA,CAAP;AACAkI,QAAAA,EAAE,CAACjI,CAAH,GAAOA,CAAP;AACA,aAAK/C,IAAL,CAAUgD,QAAV,CAAmBgI,EAAnB;AACH;AACJ;AAtlBI,CAAT","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nvar common = require(\"Common\");\nvar gameProvider = require(\"GameProvider\");\ncc._Dictionary = require(\"Dictionary\");\n\ncc.Class({\n    extends: gameProvider,\n\n    properties: {\n        // 这个属性引用了预制资源\n        playerPrefab: {\n            default: [],\n            type: cc.Prefab\n        },\n        audios: {\n            default: [],\n            type: cc.AudioClip\n        }\n    },\n\n    ctor() {\n        console.log(\"-----ctor----\");\n        this.bufferLen = 30;\n    },\n\n    goback: function (event, customEventData) {\n        this.syncTimeout();\n        cc.director.loadScene('welcome');\n    },\n\n    onLoad: function () {\n        console.log(\"---------onLoad--------\");\n\n/*\n        if (typeof (wx) !== \"undefined\") {\n            let self = this;\n            wx.onShow(function () {\n                console.log(\"wx onshow.\");\n                if (self.isShared && self.shareTag == \"keys\") {\n                    let curTime = new Date().getTime();\n                    if (curTime - self.closeTime >= 3000) {\n                        //分享成功\n                        console.log(\"分享成功\");\n                        //self.isShared = false;\n                        //self.shareTag = \"\";\n                        //self.closeTime = curTime;\n                    }\n                }\n            })\n        }\n*/\n\n        var _parent = this;\n        this.netErrDisp = false;\n        var size = cc.visibleRect;\n        var name = this.getRandomCharName();\n        this.nick = name;\n\n        this.canvasNode = this.node.parent;\n        this.resultOp = this.node.getChildByName(\"Result\").getComponent(\"Result\");\n\n        this.gameCountDown = 150; //2:30\n        //up user or down user.\n        this.mainPlayer = -1;\n        this.roomId = \"\";\n\n        this.baseAttackDuraRec = [];\n        this.agentMoveStepRec = [];\n        this._defaultBases = [\"base1\",\"base2\",\"base3\",\"base4\",\"base5\",\"base6\"];\n        \n        this.gameStartTime = 0;\n        this.gameCycleTime = 90;\n        this.gameOver=false;\n        this.addJuice = 10;  //each heart add up to magic juice bar\n\n        this.npcInfo = new cc._Dictionary();\n        this.removedNpcInfo = new cc._Dictionary();\n        this.setUser(this.getPersistantData());\n\n        console.log(\"name:\" + name);\n        this.socketHandle(this.nick);\n\n        this.putSele = [];\n        this.dragingItem = \"\";\n\n        this.clickSele = {};\n        this.magicAmount = 0;\n\n        //red alert area should not be entered by hero.\n        this.maskType = \"seleMask3\";\n\n        var canvasPt = this.node._parent.getPosition();\n        var layoutPt = this.node.getPosition();\n        var cnode, pl;\n        var magicCost = 0;\n        var role;\n        var selParams, selNode;\n        var innerId;\n\n        this.node.on(cc.Node.EventType.TOUCH_END, function (params) {\n            if(_parent.gameStartTime == 0) {\n                return;\n            }\n            var pt = params.getLocation();\n            _parent.clickProcessor(pt);\n        });\n\n/*\n        this.listener = cc.EventListener.create({\n            event: cc.EventListener.CUSTOM,  \n            eventName: \"event_effect\",\n            callback: function (event) {\n                cc.log(\"event = \"+event.getUserData());\n            }\n        });\n        cc.eventManager.addListener(this.listener, 1);\n*/\n\n        this.initEventListener();\n\n\n\n        var crabNode = cc.instantiate(this.playerPrefab[26]);    \n        crabNode.x = 100;\n        crabNode.y = 100;\n        this.node.addChild(crabNode);\n\n\n    },\n\n    getPersistantData: function() {\n        var node = cc.find('GameData').getComponent('GameData');\n        return node.getData();\n    },\n\n    setUser: function(def) {\n        var node = cc.find('GameData').getComponent('GameData');\n        var titlenode = this.node.parent.getChildByName(\"banner\").getChildByName(\"title\");\n        var levelLabel = this.node.parent.getChildByName(\"banner\").getChildByName(\"level\").getChildByName(\"levelword\").getComponent(\"cc.Label\");\n        var nameLabel = titlenode.getChildByName(\"name\").getComponent(\"cc.Label\");\n        var scoreLabel = titlenode.getChildByName(\"score\").getComponent(\"cc.Label\");\n\n        nameLabel.string = node.getNick();\n        levelLabel.string = def.level;\n        scoreLabel.string = def.myscore;\n    },\n\n    setConnFailInfo: function() {\n        this.netErrDisp = true;\n        var msgLabel = this.node.getChildByName(\"putWait\").getChildByName(\"msg\").getComponent(\"cc.Label\");\n        var retBut = this.node.getChildByName(\"putWait\").getChildByName(\"retBut\");\n        retBut.active = true;\n        msgLabel.string = \"网络连接断开!\";\n    },\n\n    setBuffDisp: function(buffType) {\n        var canvasNode = this.node.parent;\n        this.buffType = buffType;\n        if(buffType == \"heal\") {\n            canvasNode.getChildByName(\"buffHeal\").active = true;\n        }\n        else if(buffType == \"thunder\") {\n            canvasNode.getChildByName(\"buffThunder\").active = true;            \n        }\n    },\n\n/*\n    doBuff: function(event, customEventData) {\n        console.log(\"sssss:\" + customEventData);\n        var buffType = customEventData;\n        if(buffType == 1) {\n        }\n    },\n*/\n\n    setParam: function(param, timestamp) {\n        console.log(\"----param----\");\n        console.log(param);\n        console.log(timestamp);\n\n        var curTime = new Date().getTime();\n\n        console.log(\"duration:\" + (curTime - timestamp));\n\n        this.setMyCards(param);\n        this.dispCharSele();\n    },\n\n    setMyCards: function(param) {\n        var sx = -230;\n        var sy = -590;\n        var mx, my;\n        var card, cardNode, cost;\n        var moveTo;\n        //var allCards = [\"log\",\"bomb\",\"ske\",\"ir\"];\n        var allCards = param;\n        var rowItems = 0;\n        var rows = 0;\n        var cols = 0;\n        var canvasNode = this.node.parent;\n        var head = \"sel\";\n\n        for(var i=0;i<allCards.length;i++) {\n            card = cc.instantiate(this.playerPrefab[21]);\n            card._name = head + (i+1);\n            cardNode = card.getComponent('SelCard');\n            if(allCards[i]) {\n                cost = 1;\n                cardNode.setRole(allCards[i].seleRole, allCards[i].magicCost, allCards[i].roleLevel);\n            }\n\n            //this.myCardNodes.push(cardNode);                \n            cols = i%6;\n            mx = sx+(cols*105);\n            my = sy;\n            moveTo = cc.v2(mx, my);\n            card.setPosition(moveTo);\n            canvasNode.addChild(card);\n        }\n\n        for(var i=allCards.length;i<6;i++) {\n            cols = i%6;\n            mx = sx+(cols*105);\n            my = sy;\n            card = cc.instantiate(this.playerPrefab[22]);\n            moveTo = cc.v2(mx, my);\n            card.setPosition(moveTo);\n            canvasNode.addChild(card);\n        }\n    },\n\n    dispCharSele: function() {\n        var charSele = this.node.parent.getChildByName(\"charSele\");\n        charSele.zIndex = 9999;\n        charSele.active = false;\n        console.log(charSele);\n    },\n\n    gameOverProcessor:function(mainPlayer, data) {\n        if(mainPlayer == 1) {\n            if(data.win == 1) {\n                console.log(\"my win11\");\n                this.killBases(\"up\");\n            }\n            else if(data.win == 0) {\n                console.log(\"my lose11\");\n                this.killBases(\"down\");\n            }\n        }\n        else if(mainPlayer == 2) {\n            if(data.win == 1) {\n                console.log(\"my lose11\");\n                this.killBases(\"down\");\n            }\n            else if(data.win == 0) {\n                console.log(\"my win11\");\n                this.killBases(\"up\");\n            }\n        }\n    },\n\n    clickProcessor:function (clickPt) {\n        var _parent = this;\n      \n        var canvasPt = this.canvasNode.getPosition();\n        var layoutPt = this.node.getPosition();\n        var innerId;\n\n        //note that pt is the postion in canvas node.\n        var pt = clickPt;\n        var pt1 = {};\n\n        var magicCost = _parent.clickSele.magicCost;\n        var level = _parent.clickSele.level;\n        var role = _parent.clickSele.role;\n\n        if(role === undefined || role == \"\") {\n            return;\n        }  \n\n        var selCard = _parent.clickSele.params.target;\n        var selNode = _parent.clickSele.node;\n\n        var pl = selNode.parent.getPosition();  //sel card node.\n        var yOffset;\n\n        if(_parent.mainPlayer==1) {\n            yOffset=-20;\n        } else {\n            yOffset=40;\n        }\n\n        //pointer position\n        pt1.x = (layoutPt.x + pt.x - pl.x)-10;\n        pt1.y = (layoutPt.y + pt.y - pl.y)-(canvasPt.y + layoutPt.y);\n\n        //position in layout\n        pt.x = pt.x/_parent.node.scaleX - (canvasPt.x + layoutPt.x);\n        pt.y = pt.y/_parent.node.scaleY - (canvasPt.y + layoutPt.y) + yOffset;\n\n        if(!this.ifNotMaskRole(role)) {\n            this.showMask(this.maskType, 1);\n        }\n\n        if(!this.isValidPutPoint(pt) && !this.ifNotMaskRole(role)) {\n            console.log(\"invalid postion.\");\n            this.putErrorMsg();\n            return;\n        }\n\n        innerId = _parent.putClickItem(selCard, selNode, pt1);\n        _parent.sendSodier(magicCost, role, pt, innerId, level);\n    },\n\n    isValidPutPoint: function(point) {\n        var pt = {};\n        pt.x = point.x;\n        pt.y = point.y;\n        if(this.mainPlayer == 2) {\n            pt.y = point.y-40;\n        }\n\n        if(this.maskType == \"seleMask1\") {\n            if(pt.x >= 30 && pt.x <= 570 && pt.y > 0 && pt.y < 650) {\n                return true;\n            } else {\n                return false;\n            }\n        }\n        else if(this.maskType == \"seleMask12\") {\n            if((pt.x >= 30 && pt.x <= 570 && pt.y > 0 && pt.y < 420) || (pt.x >= 285 && pt.x <= 570 && pt.y > 420 && pt.y < 650)) {\n                return true;\n            } else {\n                return false;\n            }\n        }\n        else if(this.maskType == \"seleMask13\") {\n            if((pt.x >= 30 && pt.x <= 570 && pt.y > 0 && pt.y < 420) || (pt.x >= 30 && pt.x <= 285 && pt.y > 420 && pt.y < 650)) {\n                return true;\n            } else {\n                return false;\n            }\n        }\n        else if(this.maskType == \"seleMask3\") {\n            if(pt.x >= 30 && pt.x <= 570 && pt.y > 0 && pt.y < 420) {\n                return true;\n            } else {\n                return false;\n            }\n        }\n        return false;\n    },\n\n    ifNotMaskRole: function (role) {\n        if(role == \"bomb\" || role == \"thunder\"  || role == \"heal\") {\n            return true;\n        }\n        return false;\n    },\n\n    initEventListener:function () {\n        this.node.on(\"event_effect\", this.onEventEffect.bind(this));\n    },\n\n    onEventEffect:function() {\n        console.log(\"listening effect loaded....\");\n    },\n\n    setCountDown:function(counter) {\n        var min = parseInt(counter/60);\n        var sec = counter%60;\n        //console.log(min +\":\"+ sec);\n        var timeNode = this.canvasNode.getChildByName(\"banner\").getChildByName(\"time\");\n        var cdNode = timeNode.getChildByName(\"countDown\").getComponent(\"cc.Label\");\n        if(sec<10) {\n            sec = \"0\" + sec;\n        }\n        cdNode.string = (min +\":\"+ sec);\n    },\n\n    doubleMagicDisp:function() {\n        var dispnode = this.node.getChildByName(\"doubleMagic\");\n        dispnode.active = true;\n    },\n\n    setTimeCounter:function(cnt) {\n        //use to compare if timeout, only for pk mode.\n        this.gameNowTime = cnt;\n        this.setCountDown(cnt);\n        if(cnt == 60) {\n            console.log(\"magic charge speed up\");\n            this.doubleMagicDisp();\n            this.addJuice = 20;\n        }\n\n        this.setMagicBar();\n\n        //counter1.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(\"num_8.png\"));\n        //3 second is the ai page loading time.\n        var count_down = this.gameCycleTime-cnt;\n\n        if(count_down<0) {\n            this.gameOver=true;\n            return;\n        }\n\n        var tens = parseInt(count_down/10);\n        var ones = count_down%10;\n\n        //console.log(tens +\":::\"+ ones);\n    },\n\n    startTraceTimer:function() {\n        //refer to server interval setting, must a little shorter than that in server\n        this.interval = 30;\n        var then = Date.now();\n        var _parent = this;\n\n        // 30 mini seconds a game cycle.\n        var game_cycle = this.gameCycleTime*1000; \n        var game_cycle_then = Date.now();\n        var cycle_cnt = 0;\n\n        if(!this.traceTimer) {\n            this.traceTimer = function() {                \n                var now = Date.now();\n                var delta = now - then;\n\n                //when net traffic happened, idle for 5's will halt\n                //not tested yet.\n                var game_cycle_delta = now - _parent.gameStartTime;\n                // if within game cycle time\n                if(!_parent.gameOver && game_cycle_delta > cycle_cnt*1000) {\n                    cycle_cnt++;\n\n                    // if no response for 5s, then timeout\n                    if(Math.abs(cycle_cnt-_parent.gameNowTime) > 5) {\n                        this.syncTimeout();\n                    }\n                }\n\n                if(delta>_parent.interval) {\n                    then = now - (delta%_parent.interval);\n                    _parent.mainGameCycle();\n                }\n            }.bind(this);\n        }\n\n        this.schedule(this.traceTimer,0);\n    },\n\n    mainGameCycle:function() {\n        var _parent = this;\n        var data,agents,bullets,bases,forts,rollLogs,agentsFuture,fortsFuture;\n\n        if(this.gameTraceStack.length > this.bufferLen) {\n            this.gameTraceStack.shift();\n            data = this.gameTraceStack[0];\n            //data = this.gameTraceStack[this.gameTraceStack.length - 10];\n            agents = data.agents;\n            agentsFuture = this.gameTraceStack[29].agents;\n            fortsFuture = this.gameTraceStack[29].forts;\n            bullets = data.bullets;\n            bases = data.bases;\n            forts = data.forts;\n            rollLogs = data.rollLogs;\n\n            _parent.playBullets(bullets);\n            _parent.playLogs(rollLogs);\n\n            _parent.playAgents(agents, agentsFuture);\n            _parent.playBases(bases);\n            _parent.playForts(forts);\n\n            _parent.bulletProcess(bullets);\n            _parent.logProcess(rollLogs);\n            _parent.agentProcess(agents);\n            _parent.fortProcess(forts, fortsFuture);\n            _parent.baseProcess(bases);\n        }\n\n        //var event = new cc.Event.EventCustom(\"event_effect\", true);\n        //event.detail = \"123\";\n        //this.node.dispatchEvent(event);\n    },\n\n    syncTimeout:function() {\n        this.gameOver=true;\n        this.stopTraceTimer();\n        MY_SOCKET.disconnect();\n\n        console.log(\"网络断开\");\n        //this.goPrevious();                 \n    },\n\n    stopTraceTimer:function() {\n        if(this.traceTimer) {\n            this.unschedule(this.traceTimer);\n        }\n    },\n\n    playSnd:function(sndType) {\n        if(sndType == \"base\") {\n            cc.audioEngine.play(this.audios[0], false, 1);\n        }\n        else if(sndType == \"fireSend\") {\n            cc.audioEngine.play(this.audios[1], false, 1);\n        } \n        else if(sndType == \"bomb\") {\n            cc.audioEngine.play(this.audios[2], false, 1);\n        }\n        else if(sndType == \"ske\") {\n            cc.audioEngine.play(this.audios[3], false, 1);\n        }\n        else if(sndType == \"hr\") {\n            cc.audioEngine.play(this.audios[4], false, 1);\n        }\n        else if(sndType == \"lr\") {\n            cc.audioEngine.play(this.audios[5], false, 1);\n        }\n        else if(sndType == \"gi\") {\n            cc.audioEngine.play(this.audios[6], false, 1);\n        }  \n        else if(sndType == \"put1\") {\n            cc.audioEngine.play(this.audios[7], false, 1);\n        }  \n        else if(sndType == \"wizfire\") {\n            cc.audioEngine.play(this.audios[2], false, 1);\n        }  \n        else if(sndType == \"lm\") {\n            cc.audioEngine.play(this.audios[8], false, 1);\n        }  \n        else if(sndType == \"gun\") {\n            cc.audioEngine.play(this.audios[9], false, 1);\n        }  \n        else if(sndType == \"thunder\") {\n            cc.audioEngine.play(this.audios[10], false, 1);\n        }  \n        else if(sndType == \"heal\") {\n            cc.audioEngine.play(this.audios[11], false, 1);\n        } \n        else if(sndType == \"log\") {\n            cc.audioEngine.play(this.audios[12], false, 1);\n        } \n    },\n\n    playEffect: function(role, x, y) {\n        var bd;\n        //play effect.\n        //should destroy when finish.\n        if(role == \"hr\") {\n            bd = cc.instantiate(this.playerPrefab[13]);\n            bd.x = x;\n            bd.y = y+20;\n            this.node.addChild(bd);\n        }\n        if(role == \"lm\") {\n            this.playSnd(\"lm\");\n            bd = cc.instantiate(this.playerPrefab[15]);\n            bd.x = x;\n            bd.y = y-40;\n            this.node.addChild(bd);\n        }\n        else if(role == \"base\") {\n            this.playSnd(\"base\");\n            bd = cc.instantiate(this.playerPrefab[10]);\n            bd.x = x;\n            bd.y = y;\n            this.node.addChild(bd);\n        }\n        //fortA\n        else if(role == \"fa\") {\n            bd = cc.instantiate(this.playerPrefab[10]);\n            bd.x = x;\n            bd.y = y;\n            this.node.addChild(bd);\n        }\n        else if(role == \"log\") {\n            bd = cc.instantiate(this.playerPrefab[10]);\n            bd.scaleX = 0.8;\n            bd.scaleY = 0.8;\n            bd.x = x+10;\n            bd.y = y;\n            this.node.addChild(bd);\n        }\n        else if(role == \"bomb\") {\n            this.playSnd(\"bomb\");\n            //shake the screen\n            this.startSceneJitter();\n            bd = cc.instantiate(this.playerPrefab[6]);\n            bd.active = true;\n            bd.x = x;\n            bd.y = y;\n            this.node.addChild(bd);\n        }\n        else if(role == \"wizfire\") {\n            this.playSnd(\"wizfire\");\n            bd = cc.instantiate(this.playerPrefab[19]);\n            bd.active = true;\n            bd.x = x;\n            bd.y = y;\n            this.node.addChild(bd);\n        }\n    },\n\n});\n"]}