{"version":3,"sources":["assets/scripts/SocketProvider.js"],"names":["pp","require","AcWar","cc","Class","Component","properties","getRandomCharName","aphabets","nick","i","Math","floor","random","length","setGameStart","roomId","console","log","node","getChildByName","active","setGameStartTime","gameStartTime","Date","now","socketHandle","_parent","gameTraceStack","MY_SOCKET","window","io","connect","on","netErrDisp","syncTimeout","setConnFailInfo","data","heartbeatTimeout","json","emit","mainPlayer","userData","cdVal","parseInt","counter","setTimeCounter","buff","mirrorBuffData","createBuff","gameOverProcessor","resultOp","setResultValue","show","udata","Uint8Array","message","Info","decode","base","mypos","enemypos","targetpos","x","mpy","y","mpx","epy","epx","tpy","tpx","fort","agent","bullet","rollLog","traceData","agents","bases","forts","bullets","rollLogs","mirrorAgentsData","mirrorBasesData","push","bufferLen","createAgents","createBullets","createBases","createForts","createLogs","startTraceTimer","mirrorAgentsData_bak","gwidth","gheight","width","height","objectId","disconnectServer","disconnect"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nvar pp = require(\"acdata1\").AcWar;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    // start () {},\n\n    getRandomCharName: function() {\n        var aphabets =[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\",\"p\",\"q\",\"r\",\"s\",\"t\",\"u\",\"v\",\"w\",\"x\",\"y\",\"z\"];\n        var nick = \"\";\n        for(var i=0;i<6;i++) {\n            nick += aphabets[Math.floor(Math.random()*aphabets.length)];\n        } \n        return nick;\n    },\n\n    setGameStart:function(roomId) {\n        //this.gameStartTime = Date.now();\n        this.roomId = roomId;\n        console.log(\"my room:\" + this.roomId);\n\n        this.node.getChildByName(\"putWait\").active=false;\n        this.node.getChildByName(\"word3\").active=true;\n    },\n\n    setGameStartTime:function() {\n        this.gameStartTime = Date.now();\n    },\n\n    socketHandle:function(nick) {\n        var _parent = this;\n\n        this.gameTraceStack = [];\n\n        //MY_SOCKET = window.io.connect('ws://118.25.231.17:4003');\n        //MY_SOCKET = window.io.connect('wss://www.asobee.mobi:443');\n        MY_SOCKET = window.io.connect('ws://192.168.1.60:4003');\n        //MY_SOCKET = window.io.connect('ws://13.112.214.196:10088');\n\n        //console.log('check 1', MY_SOCKET.connected);\n        MY_SOCKET.on('connect_error', function(){\n            console.log('Connection Failed');\n            if(!_parent.netErrDisp) {\n                _parent.syncTimeout();\n                _parent.setConnFailInfo();\n                _parent.node.getChildByName(\"putWait\").active=true;                \n            }\n        });\n\n        MY_SOCKET.on('connected', function(data) {\n            MY_SOCKET.heartbeatTimeout = 5000;\n            MY_SOCKET.json.emit('init', {'name': nick, 'nick': nick, 'img':'', 'roomId': ''});\n        });\n\n        MY_SOCKET.on('disconnect', function(data) {\n            console.log(\"disconnect to server\");\n            _parent.syncTimeout();\n            //_parent.resultOp.show();\n            _parent.setConnFailInfo();\n            _parent.node.getChildByName(\"putWait\").active=true;     \n        });\n\n        MY_SOCKET.on('otherlogin', function (data) {\n            if(_parent.mainPlayer == -1) {\n                _parent.mainPlayer = data.userData.length;\n            }\n\n            // 2 players means game start.\n            if(data.userData.length == 2) {\n                _parent.setGameStart(data.roomId);\n            }\n        });\n\n        MY_SOCKET.on('heart', function (data) {\n            var cdVal = parseInt(data.counter);\n            _parent.setTimeCounter(cdVal);\n        });\n\n        MY_SOCKET.on('buff', function (data) {\n            console.log(\"----buff data----\");\n            console.log(data);\n            var buff = data;\n            if(_parent.mainPlayer == 2) {\n                buff = _parent.mirrorBuffData(data);\n            }\n\n            _parent.createBuff(buff);\n        });\n\n        MY_SOCKET.on('end', function (data) {\n            console.log(data);\n            console.log(_parent.mainPlayer);\n            _parent.gameOverProcessor(_parent.mainPlayer, data);\n            _parent.resultOp.setResultValue(_parent.mainPlayer, data);\n            _parent.resultOp.show();\n        });\n\n        MY_SOCKET.on('proto', function(data) {\n            let udata = new Uint8Array(data);\n            var message = pp.Info.decode(udata);\n            var base = message.base;\n\n            for(var i=0;i<message.base.length;i++) {\n                message.base[i].mypos = {};\n                message.base[i].enemypos = {};\n                message.base[i].targetpos = {};\n\n                message.base[i].mypos.x = message.base[i].mpy;\n                message.base[i].mypos.y = message.base[i].mpx*-1;\n                message.base[i].enemypos.x = message.base[i].epy;\n                message.base[i].enemypos.y = message.base[i].epx*-1;\n                message.base[i].targetpos.x = message.base[i].tpy;\n                message.base[i].targetpos.y = message.base[i].tpx*-1;\n            }\n\n            for(var i=0;i<message.fort.length;i++) {\n                message.fort[i].mypos = {};\n                message.fort[i].enemypos = {};\n                message.fort[i].targetpos = {};\n\n                message.fort[i].mypos.x = message.fort[i].mpy;\n                message.fort[i].mypos.y = message.fort[i].mpx*-1;\n                message.fort[i].enemypos.x = message.fort[i].epy;\n                message.fort[i].enemypos.y = message.fort[i].epx*-1;\n                message.fort[i].targetpos.x = message.fort[i].tpy;\n                message.fort[i].targetpos.y = message.fort[i].tpx*-1;\n            }\n\n            for(var i=0;i<message.agent.length;i++) {\n                message.agent[i].mypos = {};\n                message.agent[i].enemypos = {};\n                message.agent[i].targetpos = {};\n\n                message.agent[i].mypos.x = message.agent[i].mpy;\n                message.agent[i].mypos.y = message.agent[i].mpx*-1;\n                message.agent[i].enemypos.x = message.agent[i].epy;\n                message.agent[i].enemypos.y = message.agent[i].epx*-1;\n                message.agent[i].targetpos.x = message.agent[i].tpy;\n                message.agent[i].targetpos.y = message.agent[i].tpx*-1;\n            }\n\n            for(var i=0;i<message.bullet.length;i++) {\n                message.bullet[i].mypos = {};\n                message.bullet[i].enemypos = {};\n                message.bullet[i].targetpos = {};\n\n                message.bullet[i].mypos.x = message.bullet[i].mpy;\n                message.bullet[i].mypos.y = message.bullet[i].mpx*-1;\n                message.bullet[i].enemypos.x = message.bullet[i].epy;\n                message.bullet[i].enemypos.y = message.bullet[i].epx*-1;\n                message.bullet[i].targetpos.x = message.bullet[i].tpy;\n                message.bullet[i].targetpos.y = message.bullet[i].tpx*-1;\n            }\n\n            for(var i=0;i<message.rollLog.length;i++) {\n                message.rollLog[i].mypos = {};\n                message.rollLog[i].enemypos = {};\n                message.rollLog[i].targetpos = {};\n\n                message.rollLog[i].mypos.x = message.rollLog[i].mpy;\n                message.rollLog[i].mypos.y = message.rollLog[i].mpx*-1;\n                message.rollLog[i].enemypos.x = message.rollLog[i].epy;\n                message.rollLog[i].enemypos.y = message.rollLog[i].epx*-1;\n                message.rollLog[i].targetpos.x = message.rollLog[i].tpy;\n                message.rollLog[i].targetpos.y = message.rollLog[i].tpx*-1;\n            }\n\n            var traceData = {};\n            var agents = message.agent;\n            var bases = message.base;\n            var forts = message.fort;\n            var bullets = message.bullet;\n            var rollLogs = message.rollLog;\n\n            if(_parent.mainPlayer == 2) {\n                agents = _parent.mirrorAgentsData(agents);\n                bullets = _parent.mirrorAgentsData(bullets);\n                bases = _parent.mirrorBasesData(bases);\n                forts = _parent.mirrorAgentsData(forts);\n                rollLogs = _parent.mirrorAgentsData(rollLogs);\n            }\n\n            traceData.agents = agents;\n            traceData.bullets = bullets;\n            traceData.bases = bases;\n            traceData.forts = forts;\n            traceData.rollLogs = rollLogs;\n\n            _parent.gameTraceStack.push(traceData);\n\n            if(_parent.gameTraceStack.length > _parent.bufferLen) {\n                data = _parent.gameTraceStack[0];\n                _parent.createAgents(data.agents);\n                _parent.createBullets(data.bullets);\n                _parent.createBases(data.bases);\n                _parent.createForts(data.forts);\n                _parent.createLogs(data.rollLogs);\n                //_parent.setAgentsDir(agents);\n            }\n        });\n\n/*\n        MY_SOCKET.on('agent', function (data) {\n//            console.log(\"--------agent---------\");\n            var traceData = {};\n            var agents = data.agents;\n            var bases = data.bases;\n            var forts = data.forts;\n            var bullets = data.bullets;\n            var rollLogs = data.rollLogs;\n\n            if(_parent.mainPlayer == 2) {\n                agents = _parent.mirrorAgentsData(agents);\n                bullets = _parent.mirrorAgentsData(bullets);\n                bases = _parent.mirrorBasesData(bases);\n                forts = _parent.mirrorAgentsData(forts);\n                rollLogs = _parent.mirrorAgentsData(rollLogs);\n            }\n\n            traceData.agents = agents;\n            traceData.bullets = bullets;\n            traceData.bases = bases;\n            traceData.forts = forts;\n            traceData.rollLogs = rollLogs;\n\n            _parent.gameTraceStack.push(traceData);\n\n            if(_parent.gameTraceStack.length > _parent.bufferLen) {\n                data = _parent.gameTraceStack[0];\n                _parent.createAgents(data.agents);\n                _parent.createBullets(data.bullets);\n                _parent.createBases(data.bases);\n                _parent.createForts(data.forts);\n                _parent.createLogs(data.rollLogs);\n                //_parent.setAgentsDir(agents);\n            }\n        });\n*/\n        this.startTraceTimer();\n    },\n\n    mirrorAgentsData_bak:function(agents) {\n        //var gwidth = this.node.width/38;\n        //var gheight = this.node.height/38;\n\n        //todo\n        var gwidth = 16;\n        var gheight = 35;\n\n        for (var i = agents.length - 1; i >= 0; i--) {\n            agents[i].mypos.x = gwidth - agents[i].mypos.x;\n            agents[i].mypos.y = gheight - agents[i].mypos.y;\n\n            if(agents[i].enemypos) {\n                agents[i].enemypos.x = gwidth - agents[i].enemypos.x;\n                agents[i].enemypos.y = gheight - agents[i].enemypos.y;\n            }\n\n            //for firebomb those which has no specific enmeies, just a target location.\n            if(agents[i].targetpos) {\n                agents[i].targetpos.x = gwidth - agents[i].targetpos.x;\n                agents[i].targetpos.y = gheight - agents[i].targetpos.y;\n            }\n\n            //agents[i].rot += 180;\n        };\n        return agents;\n    },\n\n    mirrorAgentsData:function(agents) {\n        //var gwidth = this.node.width/38;\n        //var gheight = this.node.height/38;\n\n        //todo\n        var gwidth = 35;\n        var gheight = 16;\n\n        for (var i = agents.length - 1; i >= 0; i--) {\n            agents[i].mypos.x = gwidth - agents[i].mypos.x;\n\n            if(agents[i].enemypos) {\n                agents[i].enemypos.x = gwidth - agents[i].enemypos.x;\n            }\n\n            //for firebomb those which has no specific enmeies, just a target location.\n            if(agents[i].targetpos) {\n                agents[i].targetpos.x = gwidth - agents[i].targetpos.x;\n            }\n\n            //agents[i].rot += 180;\n        };\n        return agents;\n    },\n\n    mirrorBuffData:function(buff) {\n        var gwidth = this.node.width/30;\n        var gheight = this.node.height/30;\n\n        buff.mypos.x = gwidth - buff.mypos.x;\n        buff.mypos.y = gheight - buff.mypos.y;\n\n        return buff;\n    },\n\n    mirrorBasesData:function(bases) {\n        var gwidth = this.node.width/30;\n        var gheight = this.node.height/30;\n\n        for (var i = bases.length - 1; i >= 0; i--) {\n            if(bases[i].objectId == 1) {\n                bases[i].objectId = 4;\n            }\n            else if(bases[i].objectId == 2) {\n                bases[i].objectId = 6;\n            }\n            else if(bases[i].objectId == 3) {\n                bases[i].objectId = 5;\n            }\n\n            else if(bases[i].objectId == 4) {\n                bases[i].objectId = 1;\n            }\n            else if(bases[i].objectId == 6) {\n                bases[i].objectId = 2;\n            }\n            else if(bases[i].objectId == 5) {\n                bases[i].objectId = 3;\n            }\n\n            //in mirror mode, x, y should be ajusted.\n            bases[i].mypos.x = gwidth - bases[i].mypos.x-1;\n            bases[i].mypos.y = gheight - bases[i].mypos.y;\n\n            if(bases[i].enemypos) {\n                bases[i].enemypos.x = gwidth - bases[i].enemypos.x-1;\n                bases[i].enemypos.y = gheight - bases[i].enemypos.y;\n            }\n\n            //for firebomb those which has no specific enmeies, just a target location.\n            if(bases[i].targetpos) {\n                bases[i].targetpos.x = gwidth - bases[i].targetpos.x-1;\n                bases[i].targetpos.y = gheight - bases[i].targetpos.y;\n            }\n        };\n        return bases;\n    },\n\n    disconnectServer:function() {\n        MY_SOCKET.disconnect();     \n    },\n\n});\n"]}