{"version":3,"sources":["assets/scripts/GameData.js"],"names":["cc","Class","Component","properties","onLoad","game","addPersistRootNode","node","name","getRandomCharName","nick","isUpgrade","agentsDef","start","aphabets","i","Math","floor","random","length","httpPost","user","params","fd","file","url","Promise","resolve","reject","xhr","loader","getXMLHttpRequest","onreadystatechange","log","readyState","status","respone","responseText","open","setRequestHeader","send","winScore","score","myscore","setMyScore","setWxUser","userInfo","uarr","avatarUrl","split","len","ts","l1","substring","l2","nickName","setData","json","getName","getNick","getData","setMyList","mylist","myList","then","data","console","err","setUpgrade","val","_self"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        cc.game.addPersistRootNode(this.node);\n        this.name = this.getRandomCharName();\n        this.nick = this.name;\n        this.isUpgrade = false;\n\n        this.agentsDef = {\n            \"name\":\"test01\",\n            \"level\":1,\n            \"myscore\":2300,\n            \"nextscore\":3500,\n            \"basescore\":15,   //destroy one base will get that score\n            \"allList\":[\"log\",\"bomb\",\"ske\",\"ir\",\"hr\",\"bee\",\"gi\",\"lm\",\"lr\",\"wiz\"],\n            \"myList\":[\"log\",\"hr\",\"bee\",\"ske\"],\n\n            \"log\":{\n                \"level\":1,\n                \"cost\":3,\n            },\n            \"bomb\":{\n                \"level\":1,\n                \"cost\":4,\n            },\n            \"ske\":{\n                \"level\":1,\n                \"cost\":1,\n            },\n            \"ir\":{\n                \"level\":1,\n                \"cost\":3,\n            },\n            \"hr\":{\n                \"level\":1,\n                \"cost\":4,\n            },\n            \"bee\":{\n                \"level\":1,\n                \"cost\":1,\n            },\n            \"gi\":{\n                \"level\":1,\n                \"cost\":4,\n            },\n            \"lm\":{\n                \"level\":1,\n                \"cost\":3,\n            },\n            \"lr\":{\n                \"level\":1,\n                \"cost\":2,\n            },\n            \"wiz\":{\n                \"level\":1,\n                \"cost\":5,\n            },\n        };\n    },\n\n    start () {\n    },\n\n    getRandomCharName: function() {\n        var aphabets =[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\",\"p\",\"q\",\"r\",\"s\",\"t\",\"u\",\"v\",\"w\",\"x\",\"y\",\"z\"];\n        var nick = \"\";\n        for(var i=0;i<6;i++) {\n            nick += aphabets[Math.floor(Math.random()*aphabets.length)];\n        } \n        return nick;\n    },\n\n    httpPost(user,params,fd,file) {\n        var url = \"https://www.asobee.mobi/fftower/ffinfo.php?uid=\" + user;\n        //var url = \"http://localhost/fftower/ffinfo.php?uid=\" + user;\n        if(fd && file) {\n            url += \"&fd=\"+fd +\"&file=\"+file;\n        }\n\n        return new Promise((resolve,reject)=>{\n            var xhr = cc.loader.getXMLHttpRequest();\n            xhr.onreadystatechange = function () {\n                cc.log('xhr.readyState='+xhr.readyState+'  xhr.status='+xhr.status);\n                if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\n                    var respone = xhr.responseText;\n                    resolve(respone);\n                }\n                else if (xhr.readyState === 4 && xhr.status == 401) {\n                    reject(\"err\");\n                }\n                else if (xhr.readyState === 4 && xhr.status == 0){\n                    reject(\"err\");\n                }\n            };\n            xhr.open(\"GET\", url, true);\n    \n            // note: In Internet Explorer, the timeout property may be set only after calling the open()\n            // method and before calling the send() method.\n            //xhr.timeout = 5000;// 5 seconds for timeout\n            xhr.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");  \n            xhr.send(params);\n        })  \n    },\n\n    winScore : function(score) {\n        this.agentsDef.myscore += score;\n        this.setMyScore(this.agentsDef.myscore);\n    },\n\n    setWxUser : function(userInfo) {\n        var uarr = userInfo.avatarUrl.split(\"/\");\n        var len = uarr.length;\n        var ts = uarr[len-2];\n        var l1 = ts.substring(0,6);\n        var l2 = ts.substring(ts.length-6);\n        this.name = l1+l2;\n        this.nick = userInfo.nickName;\n    },\n\n    //自定义的两个函数。将值保存在this变量里\n    setData : function(json){\n        this.agentsDef = json;\n    },\n\n    getName : function(){\n        return this.name;\n    },\n\n    getNick : function(){\n        return this.nick;\n    },\n\n    getData : function(){\n        return this.agentsDef;  \n    },\n\n    setMyList : function(mylist) {\n        this.agentsDef.myList = mylist;\n\n        this.httpPost(this.name,\"\",\"list\",mylist).then((data) => {\n            console.log(\"------------setMyList------------------\");\n            console.log(data);\n        }, (err) => {\n            console.log(err);\n        });\n    },\n\n    setUpgrade : function(val) {\n        this.isUpgrade = false;                \n    },\n\n    setMyScore : function(score) {\n        var _self = this;\n        this.agentsDef.myscore = score;\n\n        this.httpPost(this.name,\"\",\"score\",score).then((data) => {\n            console.log(\"------------setMyScore------------------\");\n            console.log(data);\n            if(data == \"uped\") {\n                _self.isUpgrade = true;\n            }\n        }, (err) => {\n            console.log(err);\n        });\n    }\n\n    // update (dt) {},\n});"]}