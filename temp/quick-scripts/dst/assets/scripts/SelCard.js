
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/SelCard.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'a9c88Il+79JlLW7EwlscaCD', 'SelCard');
// scripts/SelCard.js

"use strict";

// Learn cc.Class:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html
//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html
// Learn Attribute:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html
cc.Class({
  "extends": cc.Component,
  properties: {
    seleRole: "ske",
    magicCost: 1,
    roleLevel: 1
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    //save the origin postion, becoz it will restore from shake action
    this.ox = this.node.x;
    this.oy = this.node.y;
  },
  start: function start() {
    this.isMoving = false;
    this.dragTo = null;
    this.seleInnerId = "";
    var layoutNode = this.getLayoutNode();

    var _self = this; //if in game mode page


    if (layoutNode) {
      var innerId;
      var dragItem = null;
      var layoutOp = layoutNode.getComponent('Game');
      var canvasNode = this.node.parent;
      var seleNode = canvasNode.getChildByName("charSele");
      this.node.on(cc.Node.EventType.TOUCH_START, function (params) {
        if (layoutOp.gameStartTime == 0) {
          return;
        }

        _self.node.getChildByName("dragTo").active = true;
        layoutOp.showDragMask(_self.seleRole);
        _self.seleInnerId = layoutOp.setDragItem(params, _self.node.getChildByName("dragTo"));
      });
      this.node.on(cc.Node.EventType.TOUCH_MOVE, function (params) {
        var delta = params.touch.getDelta();
        _self.isMove = true;
        layoutOp.moveDragItem(params.target._name, delta);
      });
      this.node.on(cc.Node.EventType.TOUCH_END, function (params) {
        var pt = _self.node.getPosition();

        var seleInfo = {
          "role": _self.seleRole,
          "level": _self.roleLevel,
          "magicCost": _self.magicCost,
          "params": params,
          "node": _self.node.getChildByName("dragTo")
        };

        if (_self.seleInnerId != "") {
          layoutOp.unsetDragItem(_self.seleInnerId);
          _self.seleInnerId = "";
        }

        _self.isMove = false;
        seleNode.active = true;
        seleNode.setPosition(pt);
        layoutOp.setClickItem(seleInfo);
      });
      this.node.on(cc.Node.EventType.TOUCH_CANCEL, function (params) {
        var seleInfo = {
          "role": _self.seleRole,
          "level": _self.roleLevel,
          "magicCost": _self.magicCost
        };
        layoutOp.clearDragItem(params, seleInfo);
      });
    } // in select mode page
    else {
        this.node.on(cc.Node.EventType.TOUCH_END, function (params) {
          _self.processChoose();
        });
      }

    this.setInitImgByRole();
    this.setRoleCost();
  },
  processChoose: function processChoose() {
    var layoutOp = this.node.parent.parent.getComponent('SelLayout');
    var item = layoutOp.choosenCard;
    var isValidWxRelay; //if not valid wx relay(less than 3 seconds), then do nothing.

    if (CC_WECHATGAME) {
      isValidWxRelay = layoutOp.ifWxValidRelay();

      if (!isValidWxRelay) {
        layoutOp.dispWxRelayWarn(true);
        return;
      }
    }

    if (!item || !item.role) {
      return;
    }

    var currentAgents = [];
    this.setRole(item.role, item.cost, item.level);
    this.setInitImgByRole();
    this.setRoleCost();
    currentAgents = this.getNowAgents();
    layoutOp.setCardsStatus(currentAgents);
  },
  getNowAgents: function getNowAgents() {
    var cNodes = this.node.parent._children;
    var tn;
    var ret = [];

    for (var i = 0; i < cNodes.length; i++) {
      if (cNodes[i]._name == "SelCard") {
        ret.push(cNodes[i].getComponent("SelCard").seleRole);
      }
    }

    return ret;
  },
  setRole: function setRole(role, cost, level) {
    this.seleRole = role;
    this.magicCost = cost;
    this.roleLevel = level;
  },
  getLayoutNode: function getLayoutNode() {
    return this.node.parent.getChildByName("layout");
  },
  stopCardJitter: function stopCardJitter() {
    this.node.stopAllActions();
    this.node.x = this.ox;
    this.node.y = this.oy;
  },
  //shake the card node
  startCardJitter: function startCardJitter() {
    this.node.stopAllActions();

    var _self = this;

    var sceneNode = this.node;
    var cnt = 0;
    var lower = -2;
    var upper = 2;

    var callBack = function callBack() {
      cnt++;
      var randomX = Math.floor(Math.random() * (upper - lower)) + lower;
      var randomY = Math.floor(Math.random() * (upper - lower)) + lower;
      sceneNode.x += randomX;
      sceneNode.y += randomY;

      if (cnt % 3 == 0) {
        //sceneNode.stopAllActions();
        sceneNode.x = _self.ox;
        sceneNode.y = _self.oy;
      }
    };

    var node = this.node; //场景常驻节点

    var del = cc.delayTime(1 / 30);
    var cal = cc.callFunc(callBack);
    var seq = cc.sequence(del, cal);
    node.runAction(cc.repeatForever(seq));
  },
  setRoleCost: function setRoleCost() {
    if (this.magicCost == 0) {
      return;
    }

    var mark = this.node.getChildByName("ringMark");
    var costLabel = mark.getChildByName("cost").getComponent("cc.Label");
    costLabel.string = this.magicCost;
  },
  setSelImg: function setSelImg(frameImg) {
    var dragNode = this.node.getChildByName("dragTo");
    var iconNode = this.node.getChildByName("icon");
    cc.loader.loadRes(frameImg, cc.SpriteFrame, function (err, spriteFrame) {
      dragNode.width = 100;
      dragNode.height = 120;
      dragNode.active = false;
      dragNode.getComponent(cc.Sprite).spriteFrame = spriteFrame;
      iconNode.width = 100;
      iconNode.height = 120;
      iconNode.active = true;
      iconNode.getComponent(cc.Sprite).spriteFrame = spriteFrame;
    });
  },
  setInitImgByRole: function setInitImgByRole() {
    var frameImg = "";

    if (this.seleRole == "ske") {
      this.setSelImg("sel_cards/ske");
    } //lieren
    else if (this.seleRole == "lr") {
        this.setSelImg("sel_cards/lieren");
      } //rockman
      else if (this.seleRole == "gi") {
          this.setSelImg("sel_cards/rockman");
        } else if (this.seleRole == "log") {
          this.setSelImg("sel_cards/log");
        } else if (this.seleRole == "bomb") {
          this.setSelImg("sel_cards/bomb");
        } else if (this.seleRole == "bee") {
          this.setSelImg("sel_cards/bee");
        } else if (this.seleRole == "wiz") {
          this.setSelImg("sel_cards/wiz");
        } //hero
        else if (this.seleRole == "hr") {
            this.setSelImg("sel_cards/hero");
          } //light man
          else if (this.seleRole == "lm") {
              this.setSelImg("sel_cards/lightman");
            } //hero
            else if (this.seleRole == "fa") {
                this.setSelImg("sel_cards/fortA");
              } //hero
              else if (this.seleRole == "ir") {
                  this.setSelImg("sel_cards/ironman");
                } //buff thunder
                else if (this.seleRole == "thunder") {
                    this.setSelImg("sel_cards/thunder");
                  } //buff heal
                  else if (this.seleRole == "heal") {
                      this.setSelImg("sel_cards/heal");
                    }
  } // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL1NlbENhcmQuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJzZWxlUm9sZSIsIm1hZ2ljQ29zdCIsInJvbGVMZXZlbCIsIm9uTG9hZCIsIm94Iiwibm9kZSIsIngiLCJveSIsInkiLCJzdGFydCIsImlzTW92aW5nIiwiZHJhZ1RvIiwic2VsZUlubmVySWQiLCJsYXlvdXROb2RlIiwiZ2V0TGF5b3V0Tm9kZSIsIl9zZWxmIiwiaW5uZXJJZCIsImRyYWdJdGVtIiwibGF5b3V0T3AiLCJnZXRDb21wb25lbnQiLCJjYW52YXNOb2RlIiwicGFyZW50Iiwic2VsZU5vZGUiLCJnZXRDaGlsZEJ5TmFtZSIsIm9uIiwiTm9kZSIsIkV2ZW50VHlwZSIsIlRPVUNIX1NUQVJUIiwicGFyYW1zIiwiZ2FtZVN0YXJ0VGltZSIsImFjdGl2ZSIsInNob3dEcmFnTWFzayIsInNldERyYWdJdGVtIiwiVE9VQ0hfTU9WRSIsImRlbHRhIiwidG91Y2giLCJnZXREZWx0YSIsImlzTW92ZSIsIm1vdmVEcmFnSXRlbSIsInRhcmdldCIsIl9uYW1lIiwiVE9VQ0hfRU5EIiwicHQiLCJnZXRQb3NpdGlvbiIsInNlbGVJbmZvIiwidW5zZXREcmFnSXRlbSIsInNldFBvc2l0aW9uIiwic2V0Q2xpY2tJdGVtIiwiVE9VQ0hfQ0FOQ0VMIiwiY2xlYXJEcmFnSXRlbSIsInByb2Nlc3NDaG9vc2UiLCJzZXRJbml0SW1nQnlSb2xlIiwic2V0Um9sZUNvc3QiLCJpdGVtIiwiY2hvb3NlbkNhcmQiLCJpc1ZhbGlkV3hSZWxheSIsIkNDX1dFQ0hBVEdBTUUiLCJpZld4VmFsaWRSZWxheSIsImRpc3BXeFJlbGF5V2FybiIsInJvbGUiLCJjdXJyZW50QWdlbnRzIiwic2V0Um9sZSIsImNvc3QiLCJsZXZlbCIsImdldE5vd0FnZW50cyIsInNldENhcmRzU3RhdHVzIiwiY05vZGVzIiwiX2NoaWxkcmVuIiwidG4iLCJyZXQiLCJpIiwibGVuZ3RoIiwicHVzaCIsInN0b3BDYXJkSml0dGVyIiwic3RvcEFsbEFjdGlvbnMiLCJzdGFydENhcmRKaXR0ZXIiLCJzY2VuZU5vZGUiLCJjbnQiLCJsb3dlciIsInVwcGVyIiwiY2FsbEJhY2siLCJyYW5kb21YIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicmFuZG9tWSIsImRlbCIsImRlbGF5VGltZSIsImNhbCIsImNhbGxGdW5jIiwic2VxIiwic2VxdWVuY2UiLCJydW5BY3Rpb24iLCJyZXBlYXRGb3JldmVyIiwibWFyayIsImNvc3RMYWJlbCIsInN0cmluZyIsInNldFNlbEltZyIsImZyYW1lSW1nIiwiZHJhZ05vZGUiLCJpY29uTm9kZSIsImxvYWRlciIsImxvYWRSZXMiLCJTcHJpdGVGcmFtZSIsImVyciIsInNwcml0ZUZyYW1lIiwid2lkdGgiLCJoZWlnaHQiLCJTcHJpdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxRQUFRLEVBQUUsS0FERjtBQUVSQyxJQUFBQSxTQUFTLEVBQUUsQ0FGSDtBQUdSQyxJQUFBQSxTQUFTLEVBQUM7QUFIRixHQUhQO0FBU0w7QUFFQUMsRUFBQUEsTUFYSyxvQkFXSztBQUNOO0FBQ0EsU0FBS0MsRUFBTCxHQUFVLEtBQUtDLElBQUwsQ0FBVUMsQ0FBcEI7QUFDQSxTQUFLQyxFQUFMLEdBQVUsS0FBS0YsSUFBTCxDQUFVRyxDQUFwQjtBQUNILEdBZkk7QUFpQkxDLEVBQUFBLEtBakJLLG1CQWlCSTtBQUNMLFNBQUtDLFFBQUwsR0FBZ0IsS0FBaEI7QUFDQSxTQUFLQyxNQUFMLEdBQWMsSUFBZDtBQUNBLFNBQUtDLFdBQUwsR0FBbUIsRUFBbkI7QUFDQSxRQUFJQyxVQUFVLEdBQUcsS0FBS0MsYUFBTCxFQUFqQjs7QUFDQSxRQUFJQyxLQUFLLEdBQUcsSUFBWixDQUxLLENBT0w7OztBQUNBLFFBQUdGLFVBQUgsRUFBZTtBQUNYLFVBQUlHLE9BQUo7QUFDQSxVQUFJQyxRQUFRLEdBQUcsSUFBZjtBQUNBLFVBQUlDLFFBQVEsR0FBR0wsVUFBVSxDQUFDTSxZQUFYLENBQXdCLE1BQXhCLENBQWY7QUFDQSxVQUFJQyxVQUFVLEdBQUcsS0FBS2YsSUFBTCxDQUFVZ0IsTUFBM0I7QUFDQSxVQUFJQyxRQUFRLEdBQUdGLFVBQVUsQ0FBQ0csY0FBWCxDQUEwQixVQUExQixDQUFmO0FBRUEsV0FBS2xCLElBQUwsQ0FBVW1CLEVBQVYsQ0FBYTVCLEVBQUUsQ0FBQzZCLElBQUgsQ0FBUUMsU0FBUixDQUFrQkMsV0FBL0IsRUFBNEMsVUFBVUMsTUFBVixFQUFrQjtBQUMxRCxZQUFHVixRQUFRLENBQUNXLGFBQVQsSUFBMEIsQ0FBN0IsRUFBZ0M7QUFDNUI7QUFDSDs7QUFDRGQsUUFBQUEsS0FBSyxDQUFDVixJQUFOLENBQVdrQixjQUFYLENBQTBCLFFBQTFCLEVBQW9DTyxNQUFwQyxHQUE2QyxJQUE3QztBQUNBWixRQUFBQSxRQUFRLENBQUNhLFlBQVQsQ0FBc0JoQixLQUFLLENBQUNmLFFBQTVCO0FBRUFlLFFBQUFBLEtBQUssQ0FBQ0gsV0FBTixHQUFvQk0sUUFBUSxDQUFDYyxXQUFULENBQXFCSixNQUFyQixFQUE2QmIsS0FBSyxDQUFDVixJQUFOLENBQVdrQixjQUFYLENBQTBCLFFBQTFCLENBQTdCLENBQXBCO0FBQ0gsT0FSRDtBQVVBLFdBQUtsQixJQUFMLENBQVVtQixFQUFWLENBQWE1QixFQUFFLENBQUM2QixJQUFILENBQVFDLFNBQVIsQ0FBa0JPLFVBQS9CLEVBQTJDLFVBQVVMLE1BQVYsRUFBa0I7QUFDekQsWUFBSU0sS0FBSyxHQUFHTixNQUFNLENBQUNPLEtBQVAsQ0FBYUMsUUFBYixFQUFaO0FBQ0FyQixRQUFBQSxLQUFLLENBQUNzQixNQUFOLEdBQWUsSUFBZjtBQUVBbkIsUUFBQUEsUUFBUSxDQUFDb0IsWUFBVCxDQUFzQlYsTUFBTSxDQUFDVyxNQUFQLENBQWNDLEtBQXBDLEVBQTJDTixLQUEzQztBQUNILE9BTEQ7QUFPQSxXQUFLN0IsSUFBTCxDQUFVbUIsRUFBVixDQUFhNUIsRUFBRSxDQUFDNkIsSUFBSCxDQUFRQyxTQUFSLENBQWtCZSxTQUEvQixFQUEwQyxVQUFVYixNQUFWLEVBQWtCO0FBQ3hELFlBQUljLEVBQUUsR0FBRzNCLEtBQUssQ0FBQ1YsSUFBTixDQUFXc0MsV0FBWCxFQUFUOztBQUNBLFlBQUlDLFFBQVEsR0FBRztBQUFDLGtCQUFPN0IsS0FBSyxDQUFDZixRQUFkO0FBQXdCLG1CQUFRZSxLQUFLLENBQUNiLFNBQXRDO0FBQWlELHVCQUFZYSxLQUFLLENBQUNkLFNBQW5FO0FBQThFLG9CQUFTMkIsTUFBdkY7QUFBK0Ysa0JBQU9iLEtBQUssQ0FBQ1YsSUFBTixDQUFXa0IsY0FBWCxDQUEwQixRQUExQjtBQUF0RyxTQUFmOztBQUVBLFlBQUdSLEtBQUssQ0FBQ0gsV0FBTixJQUFxQixFQUF4QixFQUE0QjtBQUN4Qk0sVUFBQUEsUUFBUSxDQUFDMkIsYUFBVCxDQUF1QjlCLEtBQUssQ0FBQ0gsV0FBN0I7QUFDQUcsVUFBQUEsS0FBSyxDQUFDSCxXQUFOLEdBQW9CLEVBQXBCO0FBQ0g7O0FBRURHLFFBQUFBLEtBQUssQ0FBQ3NCLE1BQU4sR0FBZSxLQUFmO0FBQ0FmLFFBQUFBLFFBQVEsQ0FBQ1EsTUFBVCxHQUFrQixJQUFsQjtBQUNBUixRQUFBQSxRQUFRLENBQUN3QixXQUFULENBQXFCSixFQUFyQjtBQUVBeEIsUUFBQUEsUUFBUSxDQUFDNkIsWUFBVCxDQUFzQkgsUUFBdEI7QUFDSCxPQWREO0FBZ0JBLFdBQUt2QyxJQUFMLENBQVVtQixFQUFWLENBQWE1QixFQUFFLENBQUM2QixJQUFILENBQVFDLFNBQVIsQ0FBa0JzQixZQUEvQixFQUE2QyxVQUFVcEIsTUFBVixFQUFrQjtBQUMzRCxZQUFJZ0IsUUFBUSxHQUFHO0FBQUMsa0JBQU83QixLQUFLLENBQUNmLFFBQWQ7QUFBd0IsbUJBQVFlLEtBQUssQ0FBQ2IsU0FBdEM7QUFBaUQsdUJBQVlhLEtBQUssQ0FBQ2Q7QUFBbkUsU0FBZjtBQUNBaUIsUUFBQUEsUUFBUSxDQUFDK0IsYUFBVCxDQUF1QnJCLE1BQXZCLEVBQStCZ0IsUUFBL0I7QUFDSCxPQUhEO0FBSUgsS0E1Q0QsQ0E2Q0E7QUE3Q0EsU0E4Q0s7QUFDRCxhQUFLdkMsSUFBTCxDQUFVbUIsRUFBVixDQUFhNUIsRUFBRSxDQUFDNkIsSUFBSCxDQUFRQyxTQUFSLENBQWtCZSxTQUEvQixFQUEwQyxVQUFVYixNQUFWLEVBQWtCO0FBQ3hEYixVQUFBQSxLQUFLLENBQUNtQyxhQUFOO0FBQ0gsU0FGRDtBQUdIOztBQUVELFNBQUtDLGdCQUFMO0FBQ0EsU0FBS0MsV0FBTDtBQUNILEdBL0VJO0FBaUZMRixFQUFBQSxhQUFhLEVBQUUseUJBQVc7QUFDdEIsUUFBSWhDLFFBQVEsR0FBRyxLQUFLYixJQUFMLENBQVVnQixNQUFWLENBQWlCQSxNQUFqQixDQUF3QkYsWUFBeEIsQ0FBcUMsV0FBckMsQ0FBZjtBQUNBLFFBQUlrQyxJQUFJLEdBQUduQyxRQUFRLENBQUNvQyxXQUFwQjtBQUNBLFFBQUlDLGNBQUosQ0FIc0IsQ0FLdEI7O0FBQ0EsUUFBSUMsYUFBSixFQUFtQjtBQUNmRCxNQUFBQSxjQUFjLEdBQUdyQyxRQUFRLENBQUN1QyxjQUFULEVBQWpCOztBQUNBLFVBQUcsQ0FBQ0YsY0FBSixFQUFvQjtBQUNoQnJDLFFBQUFBLFFBQVEsQ0FBQ3dDLGVBQVQsQ0FBeUIsSUFBekI7QUFDQTtBQUNIO0FBQ0o7O0FBRUQsUUFBRyxDQUFDTCxJQUFELElBQVUsQ0FBQ0EsSUFBSSxDQUFDTSxJQUFuQixFQUF5QjtBQUNyQjtBQUNIOztBQUNELFFBQUlDLGFBQWEsR0FBRyxFQUFwQjtBQUNBLFNBQUtDLE9BQUwsQ0FBYVIsSUFBSSxDQUFDTSxJQUFsQixFQUF3Qk4sSUFBSSxDQUFDUyxJQUE3QixFQUFtQ1QsSUFBSSxDQUFDVSxLQUF4QztBQUNBLFNBQUtaLGdCQUFMO0FBQ0EsU0FBS0MsV0FBTDtBQUNBUSxJQUFBQSxhQUFhLEdBQUcsS0FBS0ksWUFBTCxFQUFoQjtBQUNBOUMsSUFBQUEsUUFBUSxDQUFDK0MsY0FBVCxDQUF3QkwsYUFBeEI7QUFDSCxHQXhHSTtBQTBHTEksRUFBQUEsWUFBWSxFQUFFLHdCQUFXO0FBQ3JCLFFBQUlFLE1BQU0sR0FBRyxLQUFLN0QsSUFBTCxDQUFVZ0IsTUFBVixDQUFpQjhDLFNBQTlCO0FBQ0EsUUFBSUMsRUFBSjtBQUNBLFFBQUlDLEdBQUcsR0FBRyxFQUFWOztBQUNBLFNBQUksSUFBSUMsQ0FBQyxHQUFDLENBQVYsRUFBWUEsQ0FBQyxHQUFDSixNQUFNLENBQUNLLE1BQXJCLEVBQTRCRCxDQUFDLEVBQTdCLEVBQWlDO0FBQzdCLFVBQUdKLE1BQU0sQ0FBQ0ksQ0FBRCxDQUFOLENBQVU5QixLQUFWLElBQW1CLFNBQXRCLEVBQWlDO0FBQzdCNkIsUUFBQUEsR0FBRyxDQUFDRyxJQUFKLENBQVNOLE1BQU0sQ0FBQ0ksQ0FBRCxDQUFOLENBQVVuRCxZQUFWLENBQXVCLFNBQXZCLEVBQWtDbkIsUUFBM0M7QUFDSDtBQUNKOztBQUNELFdBQU9xRSxHQUFQO0FBQ0gsR0FwSEk7QUFzSExSLEVBQUFBLE9BQU8sRUFBRSxpQkFBU0YsSUFBVCxFQUFlRyxJQUFmLEVBQXFCQyxLQUFyQixFQUE0QjtBQUNqQyxTQUFLL0QsUUFBTCxHQUFnQjJELElBQWhCO0FBQ0EsU0FBSzFELFNBQUwsR0FBaUI2RCxJQUFqQjtBQUNBLFNBQUs1RCxTQUFMLEdBQWlCNkQsS0FBakI7QUFDSCxHQTFISTtBQTRITGpELEVBQUFBLGFBQWEsRUFBRSx5QkFBVztBQUN0QixXQUFPLEtBQUtULElBQUwsQ0FBVWdCLE1BQVYsQ0FBaUJFLGNBQWpCLENBQWdDLFFBQWhDLENBQVA7QUFDSCxHQTlISTtBQWdJTGtELEVBQUFBLGNBQWMsRUFBRSwwQkFBVTtBQUN0QixTQUFLcEUsSUFBTCxDQUFVcUUsY0FBVjtBQUNBLFNBQUtyRSxJQUFMLENBQVVDLENBQVYsR0FBYyxLQUFLRixFQUFuQjtBQUNBLFNBQUtDLElBQUwsQ0FBVUcsQ0FBVixHQUFjLEtBQUtELEVBQW5CO0FBQ0gsR0FwSUk7QUFzSUw7QUFDQW9FLEVBQUFBLGVBQWUsRUFBRSwyQkFBVTtBQUN2QixTQUFLdEUsSUFBTCxDQUFVcUUsY0FBVjs7QUFFQSxRQUFJM0QsS0FBSyxHQUFHLElBQVo7O0FBQ0EsUUFBSTZELFNBQVMsR0FBRyxLQUFLdkUsSUFBckI7QUFDQSxRQUFJd0UsR0FBRyxHQUFHLENBQVY7QUFFQSxRQUFJQyxLQUFLLEdBQUcsQ0FBQyxDQUFiO0FBQ0EsUUFBSUMsS0FBSyxHQUFHLENBQVo7O0FBQ0EsUUFBSUMsUUFBUSxHQUFHLFNBQVhBLFFBQVcsR0FBVTtBQUNyQkgsTUFBQUEsR0FBRztBQUNILFVBQUlJLE9BQU8sR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVdELElBQUksQ0FBQ0UsTUFBTCxNQUFpQkwsS0FBSyxHQUFHRCxLQUF6QixDQUFYLElBQThDQSxLQUE1RDtBQUNBLFVBQUlPLE9BQU8sR0FBR0gsSUFBSSxDQUFDQyxLQUFMLENBQVdELElBQUksQ0FBQ0UsTUFBTCxNQUFpQkwsS0FBSyxHQUFHRCxLQUF6QixDQUFYLElBQThDQSxLQUE1RDtBQUVBRixNQUFBQSxTQUFTLENBQUN0RSxDQUFWLElBQWUyRSxPQUFmO0FBQ0FMLE1BQUFBLFNBQVMsQ0FBQ3BFLENBQVYsSUFBZTZFLE9BQWY7O0FBQ0EsVUFBR1IsR0FBRyxHQUFDLENBQUosSUFBUyxDQUFaLEVBQWU7QUFDWDtBQUNBRCxRQUFBQSxTQUFTLENBQUN0RSxDQUFWLEdBQWNTLEtBQUssQ0FBQ1gsRUFBcEI7QUFDQXdFLFFBQUFBLFNBQVMsQ0FBQ3BFLENBQVYsR0FBY08sS0FBSyxDQUFDUixFQUFwQjtBQUNIO0FBQ0osS0FaRDs7QUFjQSxRQUFJRixJQUFJLEdBQUcsS0FBS0EsSUFBaEIsQ0F2QnVCLENBdUJGOztBQUNyQixRQUFJaUYsR0FBRyxHQUFHMUYsRUFBRSxDQUFDMkYsU0FBSCxDQUFhLElBQUUsRUFBZixDQUFWO0FBQ0EsUUFBSUMsR0FBRyxHQUFHNUYsRUFBRSxDQUFDNkYsUUFBSCxDQUFZVCxRQUFaLENBQVY7QUFDQSxRQUFJVSxHQUFHLEdBQUc5RixFQUFFLENBQUMrRixRQUFILENBQVlMLEdBQVosRUFBaUJFLEdBQWpCLENBQVY7QUFDQW5GLElBQUFBLElBQUksQ0FBQ3VGLFNBQUwsQ0FBZWhHLEVBQUUsQ0FBQ2lHLGFBQUgsQ0FBaUJILEdBQWpCLENBQWY7QUFDSCxHQW5LSTtBQXFLTHRDLEVBQUFBLFdBQVcsRUFBRSx1QkFBVztBQUNwQixRQUFHLEtBQUtuRCxTQUFMLElBQWtCLENBQXJCLEVBQXdCO0FBQ3BCO0FBQ0g7O0FBQ0QsUUFBSTZGLElBQUksR0FBRyxLQUFLekYsSUFBTCxDQUFVa0IsY0FBVixDQUF5QixVQUF6QixDQUFYO0FBQ0EsUUFBSXdFLFNBQVMsR0FBR0QsSUFBSSxDQUFDdkUsY0FBTCxDQUFvQixNQUFwQixFQUE0QkosWUFBNUIsQ0FBeUMsVUFBekMsQ0FBaEI7QUFDQTRFLElBQUFBLFNBQVMsQ0FBQ0MsTUFBVixHQUFtQixLQUFLL0YsU0FBeEI7QUFDSCxHQTVLSTtBQThLTGdHLEVBQUFBLFNBQVMsRUFBRSxtQkFBU0MsUUFBVCxFQUFtQjtBQUMxQixRQUFJQyxRQUFRLEdBQUcsS0FBSzlGLElBQUwsQ0FBVWtCLGNBQVYsQ0FBeUIsUUFBekIsQ0FBZjtBQUNBLFFBQUk2RSxRQUFRLEdBQUcsS0FBSy9GLElBQUwsQ0FBVWtCLGNBQVYsQ0FBeUIsTUFBekIsQ0FBZjtBQUVBM0IsSUFBQUEsRUFBRSxDQUFDeUcsTUFBSCxDQUFVQyxPQUFWLENBQWtCSixRQUFsQixFQUE0QnRHLEVBQUUsQ0FBQzJHLFdBQS9CLEVBQTRDLFVBQVVDLEdBQVYsRUFBZUMsV0FBZixFQUE0QjtBQUNwRU4sTUFBQUEsUUFBUSxDQUFDTyxLQUFULEdBQWlCLEdBQWpCO0FBQ0FQLE1BQUFBLFFBQVEsQ0FBQ1EsTUFBVCxHQUFrQixHQUFsQjtBQUNBUixNQUFBQSxRQUFRLENBQUNyRSxNQUFULEdBQWtCLEtBQWxCO0FBQ0FxRSxNQUFBQSxRQUFRLENBQUNoRixZQUFULENBQXNCdkIsRUFBRSxDQUFDZ0gsTUFBekIsRUFBaUNILFdBQWpDLEdBQStDQSxXQUEvQztBQUVBTCxNQUFBQSxRQUFRLENBQUNNLEtBQVQsR0FBaUIsR0FBakI7QUFDQU4sTUFBQUEsUUFBUSxDQUFDTyxNQUFULEdBQWtCLEdBQWxCO0FBQ0FQLE1BQUFBLFFBQVEsQ0FBQ3RFLE1BQVQsR0FBa0IsSUFBbEI7QUFDQXNFLE1BQUFBLFFBQVEsQ0FBQ2pGLFlBQVQsQ0FBc0J2QixFQUFFLENBQUNnSCxNQUF6QixFQUFpQ0gsV0FBakMsR0FBK0NBLFdBQS9DO0FBQ0gsS0FWRDtBQVdILEdBN0xJO0FBK0xMdEQsRUFBQUEsZ0JBQWdCLEVBQUUsNEJBQVc7QUFDekIsUUFBSStDLFFBQVEsR0FBRyxFQUFmOztBQUVBLFFBQUcsS0FBS2xHLFFBQUwsSUFBaUIsS0FBcEIsRUFBMkI7QUFDdkIsV0FBS2lHLFNBQUwsQ0FBZSxlQUFmO0FBQ0gsS0FGRCxDQUdBO0FBSEEsU0FJSyxJQUFHLEtBQUtqRyxRQUFMLElBQWlCLElBQXBCLEVBQTBCO0FBQzNCLGFBQUtpRyxTQUFMLENBQWUsa0JBQWY7QUFDSCxPQUZJLENBR0w7QUFISyxXQUlBLElBQUcsS0FBS2pHLFFBQUwsSUFBaUIsSUFBcEIsRUFBMEI7QUFDM0IsZUFBS2lHLFNBQUwsQ0FBZSxtQkFBZjtBQUNILFNBRkksTUFHQSxJQUFHLEtBQUtqRyxRQUFMLElBQWlCLEtBQXBCLEVBQTJCO0FBQzVCLGVBQUtpRyxTQUFMLENBQWUsZUFBZjtBQUNILFNBRkksTUFHQSxJQUFHLEtBQUtqRyxRQUFMLElBQWlCLE1BQXBCLEVBQTRCO0FBQzdCLGVBQUtpRyxTQUFMLENBQWUsZ0JBQWY7QUFDSCxTQUZJLE1BR0EsSUFBRyxLQUFLakcsUUFBTCxJQUFpQixLQUFwQixFQUEyQjtBQUM1QixlQUFLaUcsU0FBTCxDQUFlLGVBQWY7QUFDSCxTQUZJLE1BR0EsSUFBRyxLQUFLakcsUUFBTCxJQUFpQixLQUFwQixFQUEyQjtBQUM1QixlQUFLaUcsU0FBTCxDQUFlLGVBQWY7QUFDSCxTQUZJLENBR0w7QUFISyxhQUlBLElBQUcsS0FBS2pHLFFBQUwsSUFBaUIsSUFBcEIsRUFBMEI7QUFDM0IsaUJBQUtpRyxTQUFMLENBQWUsZ0JBQWY7QUFDSCxXQUZJLENBR0w7QUFISyxlQUlBLElBQUcsS0FBS2pHLFFBQUwsSUFBaUIsSUFBcEIsRUFBMEI7QUFDM0IsbUJBQUtpRyxTQUFMLENBQWUsb0JBQWY7QUFDSCxhQUZJLENBR0w7QUFISyxpQkFJQSxJQUFHLEtBQUtqRyxRQUFMLElBQWlCLElBQXBCLEVBQTBCO0FBQzNCLHFCQUFLaUcsU0FBTCxDQUFlLGlCQUFmO0FBQ0gsZUFGSSxDQUdMO0FBSEssbUJBSUEsSUFBRyxLQUFLakcsUUFBTCxJQUFpQixJQUFwQixFQUEwQjtBQUMzQix1QkFBS2lHLFNBQUwsQ0FBZSxtQkFBZjtBQUNILGlCQUZJLENBR0w7QUFISyxxQkFJQSxJQUFHLEtBQUtqRyxRQUFMLElBQWlCLFNBQXBCLEVBQStCO0FBQ2hDLHlCQUFLaUcsU0FBTCxDQUFlLG1CQUFmO0FBQ0gsbUJBRkksQ0FHTDtBQUhLLHVCQUlBLElBQUcsS0FBS2pHLFFBQUwsSUFBaUIsTUFBcEIsRUFBNEI7QUFDN0IsMkJBQUtpRyxTQUFMLENBQWUsZ0JBQWY7QUFDSDtBQUVKLEdBbFBJLENBb1BMOztBQXBQSyxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMZWFybiBjYy5DbGFzczpcbi8vICAtIFtDaGluZXNlXSBodHRwOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL2NsYXNzLmh0bWxcbi8vICAtIFtFbmdsaXNoXSBodHRwOi8vd3d3LmNvY29zMmQteC5vcmcvZG9jcy9jcmVhdG9yL2VuL3NjcmlwdGluZy9jbGFzcy5odG1sXG4vLyBMZWFybiBBdHRyaWJ1dGU6XG4vLyAgLSBbQ2hpbmVzZV0gaHR0cDovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL3poL3NjcmlwdGluZy9yZWZlcmVuY2UvYXR0cmlidXRlcy5odG1sXG4vLyAgLSBbRW5nbGlzaF0gaHR0cDovL3d3dy5jb2NvczJkLXgub3JnL2RvY3MvY3JlYXRvci9lbi9zY3JpcHRpbmcvcmVmZXJlbmNlL2F0dHJpYnV0ZXMuaHRtbFxuLy8gTGVhcm4gbGlmZS1jeWNsZSBjYWxsYmFja3M6XG4vLyAgLSBbQ2hpbmVzZV0gaHR0cDovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL3poL3NjcmlwdGluZy9saWZlLWN5Y2xlLWNhbGxiYWNrcy5odG1sXG4vLyAgLSBbRW5nbGlzaF0gaHR0cDovL3d3dy5jb2NvczJkLXgub3JnL2RvY3MvY3JlYXRvci9lbi9zY3JpcHRpbmcvbGlmZS1jeWNsZS1jYWxsYmFja3MuaHRtbFxuXG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBzZWxlUm9sZTogXCJza2VcIixcbiAgICAgICAgbWFnaWNDb3N0OiAxLFxuICAgICAgICByb2xlTGV2ZWw6MSxcbiAgICB9LFxuXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XG5cbiAgICBvbkxvYWQgKCkge1xuICAgICAgICAvL3NhdmUgdGhlIG9yaWdpbiBwb3N0aW9uLCBiZWNveiBpdCB3aWxsIHJlc3RvcmUgZnJvbSBzaGFrZSBhY3Rpb25cbiAgICAgICAgdGhpcy5veCA9IHRoaXMubm9kZS54O1xuICAgICAgICB0aGlzLm95ID0gdGhpcy5ub2RlLnk7ICAgICAgICAgICAgXG4gICAgfSxcblxuICAgIHN0YXJ0ICgpIHtcbiAgICAgICAgdGhpcy5pc01vdmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmRyYWdUbyA9IG51bGw7XG4gICAgICAgIHRoaXMuc2VsZUlubmVySWQgPSBcIlwiO1xuICAgICAgICB2YXIgbGF5b3V0Tm9kZSA9IHRoaXMuZ2V0TGF5b3V0Tm9kZSgpO1xuICAgICAgICB2YXIgX3NlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8vaWYgaW4gZ2FtZSBtb2RlIHBhZ2VcbiAgICAgICAgaWYobGF5b3V0Tm9kZSkge1xuICAgICAgICAgICAgdmFyIGlubmVySWQ7XG4gICAgICAgICAgICB2YXIgZHJhZ0l0ZW0gPSBudWxsO1xuICAgICAgICAgICAgdmFyIGxheW91dE9wID0gbGF5b3V0Tm9kZS5nZXRDb21wb25lbnQoJ0dhbWUnKTtcbiAgICAgICAgICAgIHZhciBjYW52YXNOb2RlID0gdGhpcy5ub2RlLnBhcmVudDtcbiAgICAgICAgICAgIHZhciBzZWxlTm9kZSA9IGNhbnZhc05vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJjaGFyU2VsZVwiKTtcblxuICAgICAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJULCBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgaWYobGF5b3V0T3AuZ2FtZVN0YXJ0VGltZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgX3NlbGYubm9kZS5nZXRDaGlsZEJ5TmFtZShcImRyYWdUb1wiKS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGxheW91dE9wLnNob3dEcmFnTWFzayhfc2VsZi5zZWxlUm9sZSk7XG5cbiAgICAgICAgICAgICAgICBfc2VsZi5zZWxlSW5uZXJJZCA9IGxheW91dE9wLnNldERyYWdJdGVtKHBhcmFtcywgX3NlbGYubm9kZS5nZXRDaGlsZEJ5TmFtZShcImRyYWdUb1wiKSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVsdGEgPSBwYXJhbXMudG91Y2guZ2V0RGVsdGEoKTtcbiAgICAgICAgICAgICAgICBfc2VsZi5pc01vdmUgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgbGF5b3V0T3AubW92ZURyYWdJdGVtKHBhcmFtcy50YXJnZXQuX25hbWUsIGRlbHRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5ELCBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIHB0ID0gX3NlbGYubm9kZS5nZXRQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIHZhciBzZWxlSW5mbyA9IHtcInJvbGVcIjpfc2VsZi5zZWxlUm9sZSwgXCJsZXZlbFwiOl9zZWxmLnJvbGVMZXZlbCwgXCJtYWdpY0Nvc3RcIjpfc2VsZi5tYWdpY0Nvc3QsIFwicGFyYW1zXCI6cGFyYW1zLCBcIm5vZGVcIjpfc2VsZi5ub2RlLmdldENoaWxkQnlOYW1lKFwiZHJhZ1RvXCIpfTtcblxuICAgICAgICAgICAgICAgIGlmKF9zZWxmLnNlbGVJbm5lcklkICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGF5b3V0T3AudW5zZXREcmFnSXRlbShfc2VsZi5zZWxlSW5uZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIF9zZWxmLnNlbGVJbm5lcklkID0gXCJcIjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfc2VsZi5pc01vdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBzZWxlTm9kZS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHNlbGVOb2RlLnNldFBvc2l0aW9uKHB0KTtcblxuICAgICAgICAgICAgICAgIGxheW91dE9wLnNldENsaWNrSXRlbShzZWxlSW5mbyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0NBTkNFTCwgZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciBzZWxlSW5mbyA9IHtcInJvbGVcIjpfc2VsZi5zZWxlUm9sZSwgXCJsZXZlbFwiOl9zZWxmLnJvbGVMZXZlbCwgXCJtYWdpY0Nvc3RcIjpfc2VsZi5tYWdpY0Nvc3R9O1xuICAgICAgICAgICAgICAgIGxheW91dE9wLmNsZWFyRHJhZ0l0ZW0ocGFyYW1zLCBzZWxlSW5mbyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBcbiAgICAgICAgLy8gaW4gc2VsZWN0IG1vZGUgcGFnZVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9FTkQsIGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBfc2VsZi5wcm9jZXNzQ2hvb3NlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0SW5pdEltZ0J5Um9sZSgpO1xuICAgICAgICB0aGlzLnNldFJvbGVDb3N0KCk7XG4gICAgfSxcblxuICAgIHByb2Nlc3NDaG9vc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbGF5b3V0T3AgPSB0aGlzLm5vZGUucGFyZW50LnBhcmVudC5nZXRDb21wb25lbnQoJ1NlbExheW91dCcpO1xuICAgICAgICB2YXIgaXRlbSA9IGxheW91dE9wLmNob29zZW5DYXJkO1xuICAgICAgICB2YXIgaXNWYWxpZFd4UmVsYXk7XG5cbiAgICAgICAgLy9pZiBub3QgdmFsaWQgd3ggcmVsYXkobGVzcyB0aGFuIDMgc2Vjb25kcyksIHRoZW4gZG8gbm90aGluZy5cbiAgICAgICAgaWYgKENDX1dFQ0hBVEdBTUUpIHtcbiAgICAgICAgICAgIGlzVmFsaWRXeFJlbGF5ID0gbGF5b3V0T3AuaWZXeFZhbGlkUmVsYXkoKTtcbiAgICAgICAgICAgIGlmKCFpc1ZhbGlkV3hSZWxheSkge1xuICAgICAgICAgICAgICAgIGxheW91dE9wLmRpc3BXeFJlbGF5V2Fybih0cnVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZighaXRlbSAgfHwgIWl0ZW0ucm9sZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjdXJyZW50QWdlbnRzID0gW107XG4gICAgICAgIHRoaXMuc2V0Um9sZShpdGVtLnJvbGUsIGl0ZW0uY29zdCwgaXRlbS5sZXZlbCk7XG4gICAgICAgIHRoaXMuc2V0SW5pdEltZ0J5Um9sZSgpO1xuICAgICAgICB0aGlzLnNldFJvbGVDb3N0KCk7XG4gICAgICAgIGN1cnJlbnRBZ2VudHMgPSB0aGlzLmdldE5vd0FnZW50cygpO1xuICAgICAgICBsYXlvdXRPcC5zZXRDYXJkc1N0YXR1cyhjdXJyZW50QWdlbnRzKTtcbiAgICB9LFxuXG4gICAgZ2V0Tm93QWdlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNOb2RlcyA9IHRoaXMubm9kZS5wYXJlbnQuX2NoaWxkcmVuO1xuICAgICAgICB2YXIgdG47XG4gICAgICAgIHZhciByZXQgPSBbXTtcbiAgICAgICAgZm9yKHZhciBpPTA7aTxjTm9kZXMubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgaWYoY05vZGVzW2ldLl9uYW1lID09IFwiU2VsQ2FyZFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0LnB1c2goY05vZGVzW2ldLmdldENvbXBvbmVudChcIlNlbENhcmRcIikuc2VsZVJvbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcblxuICAgIHNldFJvbGU6IGZ1bmN0aW9uKHJvbGUsIGNvc3QsIGxldmVsKSB7XG4gICAgICAgIHRoaXMuc2VsZVJvbGUgPSByb2xlO1xuICAgICAgICB0aGlzLm1hZ2ljQ29zdCA9IGNvc3Q7XG4gICAgICAgIHRoaXMucm9sZUxldmVsID0gbGV2ZWw7XG4gICAgfSxcblxuICAgIGdldExheW91dE5vZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ub2RlLnBhcmVudC5nZXRDaGlsZEJ5TmFtZShcImxheW91dFwiKTtcbiAgICB9LFxuXG4gICAgc3RvcENhcmRKaXR0ZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMubm9kZS5zdG9wQWxsQWN0aW9ucygpO1xuICAgICAgICB0aGlzLm5vZGUueCA9IHRoaXMub3g7XG4gICAgICAgIHRoaXMubm9kZS55ID0gdGhpcy5veTsgXG4gICAgfSxcblxuICAgIC8vc2hha2UgdGhlIGNhcmQgbm9kZVxuICAgIHN0YXJ0Q2FyZEppdHRlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5ub2RlLnN0b3BBbGxBY3Rpb25zKCk7XG5cbiAgICAgICAgdmFyIF9zZWxmID0gdGhpcztcbiAgICAgICAgdmFyIHNjZW5lTm9kZSA9IHRoaXMubm9kZTtcbiAgICAgICAgdmFyIGNudCA9IDA7XG5cbiAgICAgICAgdmFyIGxvd2VyID0gLTI7XG4gICAgICAgIHZhciB1cHBlciA9IDI7XG4gICAgICAgIHZhciBjYWxsQmFjayA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjbnQrKztcbiAgICAgICAgICAgIHZhciByYW5kb21YID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHVwcGVyIC0gbG93ZXIpKSArIGxvd2VyO1xuICAgICAgICAgICAgdmFyIHJhbmRvbVkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodXBwZXIgLSBsb3dlcikpICsgbG93ZXI7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHNjZW5lTm9kZS54ICs9IHJhbmRvbVg7XG4gICAgICAgICAgICBzY2VuZU5vZGUueSArPSByYW5kb21ZO1xuICAgICAgICAgICAgaWYoY250JTMgPT0gMCkge1xuICAgICAgICAgICAgICAgIC8vc2NlbmVOb2RlLnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgICAgICAgICAgICAgc2NlbmVOb2RlLnggPSBfc2VsZi5veDtcbiAgICAgICAgICAgICAgICBzY2VuZU5vZGUueSA9IF9zZWxmLm95O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLm5vZGU7Ly/lnLrmma/luLjpqbvoioLngrlcbiAgICAgICAgdmFyIGRlbCA9IGNjLmRlbGF5VGltZSgxLzMwKTtcbiAgICAgICAgdmFyIGNhbCA9IGNjLmNhbGxGdW5jKGNhbGxCYWNrKTtcbiAgICAgICAgdmFyIHNlcSA9IGNjLnNlcXVlbmNlKGRlbCwgY2FsKTtcbiAgICAgICAgbm9kZS5ydW5BY3Rpb24oY2MucmVwZWF0Rm9yZXZlcihzZXEpKTtcbiAgICB9LFxuXG4gICAgc2V0Um9sZUNvc3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZih0aGlzLm1hZ2ljQ29zdCA9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG1hcmsgPSB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJyaW5nTWFya1wiKTtcbiAgICAgICAgdmFyIGNvc3RMYWJlbCA9IG1hcmsuZ2V0Q2hpbGRCeU5hbWUoXCJjb3N0XCIpLmdldENvbXBvbmVudChcImNjLkxhYmVsXCIpO1xuICAgICAgICBjb3N0TGFiZWwuc3RyaW5nID0gdGhpcy5tYWdpY0Nvc3Q7XG4gICAgfSxcblxuICAgIHNldFNlbEltZzogZnVuY3Rpb24oZnJhbWVJbWcpIHtcbiAgICAgICAgdmFyIGRyYWdOb2RlID0gdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwiZHJhZ1RvXCIpO1xuICAgICAgICB2YXIgaWNvbk5vZGUgPSB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJpY29uXCIpO1xuXG4gICAgICAgIGNjLmxvYWRlci5sb2FkUmVzKGZyYW1lSW1nLCBjYy5TcHJpdGVGcmFtZSwgZnVuY3Rpb24gKGVyciwgc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgICAgIGRyYWdOb2RlLndpZHRoID0gMTAwO1xuICAgICAgICAgICAgZHJhZ05vZGUuaGVpZ2h0ID0gMTIwO1xuICAgICAgICAgICAgZHJhZ05vZGUuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICBkcmFnTm9kZS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHNwcml0ZUZyYW1lO1xuXG4gICAgICAgICAgICBpY29uTm9kZS53aWR0aCA9IDEwMDtcbiAgICAgICAgICAgIGljb25Ob2RlLmhlaWdodCA9IDEyMDtcbiAgICAgICAgICAgIGljb25Ob2RlLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICBpY29uTm9kZS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHNwcml0ZUZyYW1lO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2V0SW5pdEltZ0J5Um9sZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBmcmFtZUltZyA9IFwiXCI7XG5cbiAgICAgICAgaWYodGhpcy5zZWxlUm9sZSA9PSBcInNrZVwiKSB7XG4gICAgICAgICAgICB0aGlzLnNldFNlbEltZyhcInNlbF9jYXJkcy9za2VcIik7XG4gICAgICAgIH1cbiAgICAgICAgLy9saWVyZW5cbiAgICAgICAgZWxzZSBpZih0aGlzLnNlbGVSb2xlID09IFwibHJcIikge1xuICAgICAgICAgICAgdGhpcy5zZXRTZWxJbWcoXCJzZWxfY2FyZHMvbGllcmVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8vcm9ja21hblxuICAgICAgICBlbHNlIGlmKHRoaXMuc2VsZVJvbGUgPT0gXCJnaVwiKSB7XG4gICAgICAgICAgICB0aGlzLnNldFNlbEltZyhcInNlbF9jYXJkcy9yb2NrbWFuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYodGhpcy5zZWxlUm9sZSA9PSBcImxvZ1wiKSB7XG4gICAgICAgICAgICB0aGlzLnNldFNlbEltZyhcInNlbF9jYXJkcy9sb2dcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZih0aGlzLnNlbGVSb2xlID09IFwiYm9tYlwiKSB7XG4gICAgICAgICAgICB0aGlzLnNldFNlbEltZyhcInNlbF9jYXJkcy9ib21iXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYodGhpcy5zZWxlUm9sZSA9PSBcImJlZVwiKSB7XG4gICAgICAgICAgICB0aGlzLnNldFNlbEltZyhcInNlbF9jYXJkcy9iZWVcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZih0aGlzLnNlbGVSb2xlID09IFwid2l6XCIpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U2VsSW1nKFwic2VsX2NhcmRzL3dpelwiKTtcbiAgICAgICAgfVxuICAgICAgICAvL2hlcm9cbiAgICAgICAgZWxzZSBpZih0aGlzLnNlbGVSb2xlID09IFwiaHJcIikge1xuICAgICAgICAgICAgdGhpcy5zZXRTZWxJbWcoXCJzZWxfY2FyZHMvaGVyb1wiKTtcbiAgICAgICAgfVxuICAgICAgICAvL2xpZ2h0IG1hblxuICAgICAgICBlbHNlIGlmKHRoaXMuc2VsZVJvbGUgPT0gXCJsbVwiKSB7XG4gICAgICAgICAgICB0aGlzLnNldFNlbEltZyhcInNlbF9jYXJkcy9saWdodG1hblwiKTtcbiAgICAgICAgfVxuICAgICAgICAvL2hlcm9cbiAgICAgICAgZWxzZSBpZih0aGlzLnNlbGVSb2xlID09IFwiZmFcIikge1xuICAgICAgICAgICAgdGhpcy5zZXRTZWxJbWcoXCJzZWxfY2FyZHMvZm9ydEFcIik7XG4gICAgICAgIH1cbiAgICAgICAgLy9oZXJvXG4gICAgICAgIGVsc2UgaWYodGhpcy5zZWxlUm9sZSA9PSBcImlyXCIpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U2VsSW1nKFwic2VsX2NhcmRzL2lyb25tYW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgLy9idWZmIHRodW5kZXJcbiAgICAgICAgZWxzZSBpZih0aGlzLnNlbGVSb2xlID09IFwidGh1bmRlclwiKSB7XG4gICAgICAgICAgICB0aGlzLnNldFNlbEltZyhcInNlbF9jYXJkcy90aHVuZGVyXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8vYnVmZiBoZWFsXG4gICAgICAgIGVsc2UgaWYodGhpcy5zZWxlUm9sZSA9PSBcImhlYWxcIikge1xuICAgICAgICAgICAgdGhpcy5zZXRTZWxJbWcoXCJzZWxfY2FyZHMvaGVhbFwiKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgLy8gdXBkYXRlIChkdCkge30sXG59KTtcbiJdfQ==